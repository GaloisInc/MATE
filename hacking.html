

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Hacking on MATE &mdash; MATE 0.1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Writing and running MATE’s tests" href="testing.html" />
    <link rel="prev" title="MATE POI Analyses" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MATE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">For MATE Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="user-workflow.html">MATE User Workflow</a></li>
<li class="toctree-l1"><a class="reference internal" href="vulnerability-types.html">Vulnerability Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-flowfinder.html">Using Flowfinder</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For MATE Power Users</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="using-rest-api.html">Using the REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-notebooks.html">MATE Python Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="usagefinder.html">UsageFinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="mantiserve.html">Mantiserve</a></li>
<li class="toctree-l1"><a class="reference internal" href="under-constrained-manticore.html">Under-constrained Manticore</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Troubleshooting Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="debugging-builds.html">Debugging Challenge Build Failures</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">MATE Implementation Details</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">MATE System Overview</a></li>
<li class="toctree-l1"><a class="reference external" href="api.html#http://">MATE REST API</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemata/cpg.html">CPG Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">MATE Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html">MATE POI Analyses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">For MATE Developers</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Hacking on MATE</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#overview">Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-tour-of-the-codebase">A tour of the codebase</a></li>
<li class="toctree-l2"><a class="reference internal" href="#building-and-running">Building and Running</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building-with-docker">Building with Docker</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#quickstart">Quickstart</a></li>
<li class="toctree-l4"><a class="reference internal" href="#explanation">Explanation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#useful-options-for-working-with-docker">Useful options for working with Docker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#run-the-build">Run the build</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#hacking-on-the-mate-ui">Hacking on the MATE UI</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#development-practices">Development practices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#documenting-development-practices">Documenting development practices</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-gitlab">Using Gitlab</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mrs">MRs</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#code-review">Code review</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#using-git">Using Git</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#commit-messages">Commit messages</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#linting-and-formatting">Linting and formatting</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#mypy">Mypy</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#further-reading">Further reading</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#documentation">Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#building">Building</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing">Writing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#deployment">Deployment</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-json-schemata">The JSON schemata</a></li>
<li class="toctree-l3"><a class="reference internal" href="#the-wiki">The Wiki</a></li>
<li class="toctree-l3"><a class="reference internal" href="#capitalization-conventions">Capitalization conventions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-new-model-to-the-cpg">Adding a new model to the CPG</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#considerations">Considerations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#changes">Changes</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#enumerations">Enumerations</a></li>
<li class="toctree-l4"><a class="reference internal" href="#schemata">Schemata</a></li>
<li class="toctree-l4"><a class="reference internal" href="#adding-the-model">Adding the model</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#adding-a-poi-query">Adding a POI Query</a></li>
<li class="toctree-l2"><a class="reference internal" href="#querying-the-sql-db-directly">Querying the SQL DB Directly</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#listing-nodes-edges">Listing Nodes/Edges</a></li>
<li class="toctree-l3"><a class="reference internal" href="#filtering-on-node-edge-attributes">Filtering on Node/Edge Attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#statically-sized-joins">Statically-Sized Joins</a></li>
<li class="toctree-l3"><a class="reference internal" href="#path-queries">Path Queries</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#extensions">Extensions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#shortcomings">Shortcomings</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#internal-state-machines">Internal state machines</a></li>
<li class="toctree-l2"><a class="reference internal" href="#ci-and-git-branches">CI and Git Branches</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementation">Implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-releases">Building Releases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#developing-against-the-chess-system">Developing Against the CHESS System</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#make-mate-specific-changes">Make MATE-Specific Changes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bump-stack-definitions-and-message-schemas">Bump stack definitions and message schemas</a></li>
<li class="toctree-l3"><a class="reference internal" href="#bump-submodule-revisions-in-mate">Bump submodule revisions in MATE</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#pointer-analysis">Pointer Analysis</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#running-souffle">Running Souffle</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#profiling">Profiling</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#debugging-the-pointer-analysis-results">Debugging the pointer analysis results</a></li>
<li class="toctree-l3"><a class="reference internal" href="#plots">Plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="#tests">Tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#publishing-the-mate-packages-to-pypi">Publishing the MATE packages to PyPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#project-infrastructure">Project Infrastructure</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Writing and running MATE’s tests</a></li>
<li class="toctree-l1"><a class="reference internal" href="architecture.html">MATE Tooling Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="chess-system.html">Working with the CHESS System</a></li>
<li class="toctree-l1"><a class="reference internal" href="getting-started.html">Starting Stand-alone MATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="mate-cli-overview.html">mate-cli Command Line Tool Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Tools Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="dwarfcore.html">Dwarfcore</a></li>
<li class="toctree-l1"><a class="reference internal" href="standalonepa.html">cclyzer++</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">MATE Traces</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment variables in the MATE container</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">MATE API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MATE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Hacking on MATE</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/hacking.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hacking-on-mate">
<h1>Hacking on MATE<a class="headerlink" href="#hacking-on-mate" title="Permalink to this headline">¶</a></h1>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>This page is intended for the developers of MATE only – it is not relevant for users.</p>
</div>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Hello and welcome! 👋</p>
<p>If you are new to MATE, please check out:</p>
<ol class="arabic simple">
<li><p>The <a class="reference internal" href="user-workflow.html"><span class="doc">MATE User Workflow</span></a></p></li>
<li><p>The <a class="reference internal" href="overview.html"><span class="doc">MATE System Overview</span></a></p></li>
</ol>
<p>Then continuing reading this page to understand what <a class="reference internal" href="#documentation"><span class="std std-ref">Documentation</span></a> is available, get a tour of the codebase, and learn about our build workflow and engineering practices.</p>
<p>To get up to speed on what is represented in the Code Property Graph (CPG) take
a look at the <a class="reference internal" href="schemata/cpg.html"><span class="doc">CPG schema</span></a>, which describes the
types of Nodes and Edges in the CPG, as well as what properties they contain.</p>
<p>To get write queries and play with the query interface, the best place to start
is with <a class="reference internal" href="using-notebooks.html"><span class="doc">MATE Python Notebooks</span></a>. You can search and browse the autogenerated
<a class="reference internal" href="api/MATE/modules.html"><span class="doc">API documentation</span></a>.</p>
</div>
<div class="section" id="a-tour-of-the-codebase">
<h2>A tour of the codebase<a class="headerlink" href="#a-tour-of-the-codebase" title="Permalink to this headline">¶</a></h2>
<p>Below is some context on what some of the files and directories contain, along
with what you might want to know about them.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> &amp; <code class="docutils literal notranslate"><span class="pre">requirements.txt</span></code>: These files encode the dependencies
necessary to build and to run <code class="docutils literal notranslate"><span class="pre">mate</span></code>. MATE is released in the <code class="docutils literal notranslate"><span class="pre">mate-dist</span></code>
docker image, which contains only the minimal number of dependencies to run
<code class="docutils literal notranslate"><span class="pre">mate</span></code>, while <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code> contains all the dependencies needed to for
developing <code class="docutils literal notranslate"><span class="pre">mate</span></code>. Our CI pipeline builds both of these images each time it
runs (such as when you push a commit to an open merge request), and pushes the
images tagged with the branch name to artifactory. You can download each of
these images with the command <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">pull</span>
<span class="pre">artifactory.galois.com:5004/mate-dev:&lt;branch-name&gt;</span></code>. Any time the content of
these files changes you will need to pull the corresponding image from
Artifactory or rebuild locally. You can rebuild locally by running <code class="docutils literal notranslate"><span class="pre">docker</span>
<span class="pre">build</span> <span class="pre">--target</span> <span class="pre">dist</span> <span class="pre">--tag</span> <span class="pre">&lt;branch&gt;:&lt;version&gt;</span> <span class="pre">.</span></code> in the root directory
(the tag is arbitrary, the format suggested here is based on your current
<code class="docutils literal notranslate"><span class="pre">git</span></code> branch and some version number).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">shake/exe/Mate.hs</span></code>: We use the <a class="reference external" href="https://shakebuild.com/">Shake</a> build
system to build MATE; this is the file where the build system is defined. You
can build MATE from inside the <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code> container by running <code class="docutils literal notranslate"><span class="pre">./shake.sh</span>
<span class="pre">bdist</span></code>, which builds the binary distribution of MATE. This will create or
update files in the <code class="docutils literal notranslate"><span class="pre">.out</span></code> output directory. If you want to change, add or
see the details of any flags to the build system <code class="docutils literal notranslate"><span class="pre">Mate.hs</span></code> is the file to
check out.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.gitlab-ci.yml</span></code>: This file defines the commands executed by each of the CI
pipeline stages.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend</span></code>: Files related to the MATE REST API, task substrate, integrations
with other CHESS TAs, and the legacy <code class="docutils literal notranslate"><span class="pre">mate</span></code> command line interface
(CLI). For more CLI documentation check out <a class="reference internal" href="mate-cli-overview.html"><span class="doc">the MATE CLI overview</span></a> as well as
<a class="reference internal" href="cli.html"><span class="doc">the full (autogenerated) docs</span></a> of all the command line flags. The
<code class="docutils literal notranslate"><span class="pre">mate</span></code> executable lives at <code class="docutils literal notranslate"><span class="pre">frontend/mate/bin/mate</span></code>. When you build <code class="docutils literal notranslate"><span class="pre">mate</span></code>
by running <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">bdist</span></code> in the <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code> image, the frontend/mate
directory gets copied to
<code class="docutils literal notranslate"><span class="pre">.out/bdist/local/lib/python3.8/site-packages/mate</span></code>.</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate-common</span></code>: This is an independent package for MATE
components that are shared by both the MATE server, consumers of the
<code class="docutils literal notranslate"><span class="pre">mate</span></code> Python package, and the REST client.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate-rest-client</span></code>: This is an independent Python binding
for MATE’s REST API.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/cpg</span></code>: This is where the query interface implementation
lives. This is where Python classes corresponding to CPG elements (such as
Nodes) are defined, along with the specification of their attributes.
There are many different types of nodes in a hierarchical relationship,
where child type nodes inherit the attributes of the parent nodes. We use
<a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> to implement the queries.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/poi</span></code>: This is the home of the POI (Point Of Interest)
framework code as well as all automated POI analyses. For more info see
the POI docs.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/context/cli.py</span></code>: This file defines all the command line
options and uses the <code class="docutils literal notranslate"><span class="pre">argparse</span></code> library to construct a context object.
This context object shows up throughout the legacy CLI code in
<code class="docutils literal notranslate"><span class="pre">frontend/mate</span></code>, usually bound to a variable named <code class="docutils literal notranslate"><span class="pre">ctxt</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">test/postgres</span></code>: This directory contains unit tests for features related
to querying the CPG using the Python query interface. See
<a class="reference internal" href="testing.html"><span class="doc">Writing and running MATE’s tests</span></a> for more details on running the various test suites as
well as writing new unit tests.</p></li>
</ul>
</div></blockquote>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">llvm</span></code>: This directory contains our “middle-end” LLVM passes which are run
with <code class="docutils literal notranslate"><span class="pre">opt</span></code>. <code class="docutils literal notranslate"><span class="pre">llvm/MATE/ASTGraphWriter.cpp</span></code> is the pass which traverses
the program under analysis and writes out the nodes and edges of our CPG into
a JSONL file. These JSONL files are then post-processed to create the
database which the query interface queries against. The pointer analysis is
also implemented as a middle-end pass and passes data into the
<code class="docutils literal notranslate"><span class="pre">ASTGraphWriter</span></code>. See the
<a class="reference internal" href="architecture.html"><span class="doc">MATE Tooling Architecture</span></a> documentation for more details.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">submodules</span></code>: MATE contains a number of other projects as submodules, which
reside in the <code class="docutils literal notranslate"><span class="pre">submodules</span></code> directory. Whenever the code changes to rely on
an updated version of a submodule, you’ll need to get a later version by
running <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">submodule</span> <span class="pre">update</span> <span class="pre">--init</span> <span class="pre">--recursive</span></code>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ui-client</span></code>: This directory contains the MATE UI client. See the
<a class="reference internal" href="#hacking-on-the-mate-ui"><span class="std std-ref">Hacking on the MATE UI</span></a> section below.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">doc</span></code>: This directory contains our documentation (in addition to the
documentation contained in docstrings!) For more info, see
the <a class="reference internal" href="#documentation"><span class="std std-ref">Documentation</span></a> section below.</p></li>
</ul>
</div>
<div class="section" id="building-and-running">
<h2>Building and Running<a class="headerlink" href="#building-and-running" title="Permalink to this headline">¶</a></h2>
<p>Below is an outline of two different environments for building &amp; executing MATE,
and an overview of different parts of the analysis and implementation.</p>
<div class="section" id="building-with-docker">
<h3>Building with Docker<a class="headerlink" href="#building-with-docker" title="Permalink to this headline">¶</a></h3>
<div class="section" id="quickstart">
<h4>Quickstart<a class="headerlink" href="#quickstart" title="Permalink to this headline">¶</a></h4>
<div class="section" id="permissions">
<h5>Permissions<a class="headerlink" href="#permissions" title="Permalink to this headline">¶</a></h5>
<p>In order to build MATE, you need to make sure you have permissions for the
following:</p>
<ul class="simple">
<li><p>Artifactory</p></li>
<li><p>The MATE repos</p></li>
</ul>
<p>Here is a quickstart of the commands if copying and pasting to do a new build or
starting up on a new machine. Each command is explained in more detail after
this section.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker login artifactory.galois.com:5004
docker pull artifactory.galois.com:5004/mate-dev:master
docker tag artifactory.galois.com:5004/mate-dev:master mate-dev
git clone --recurse-submodules git@gitlab-ext.galois.com:mate/MATE.git
<span class="nb">cd</span> MATE
docker run --rm -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/mate -it mate-dev ./shake.sh -j bdist
docker build --target dist -t mate-dist .
</pre></div>
</div>
</div>
</div>
<div class="section" id="explanation">
<h4>Explanation<a class="headerlink" href="#explanation" title="Permalink to this headline">¶</a></h4>
<p>First, authenticate with Artifactory:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker login artifactory.galois.com:5004
</pre></div>
</div>
<p>Pull the latest Docker image from the Artifactory repository.
The development image is <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code>, and the release image is
<code class="docutils literal notranslate"><span class="pre">mate-dist</span></code>. For this example, we’ll be using <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker pull artifactory.galois.com:5004/mate-dev:master
</pre></div>
</div>
<p>Re-tag the <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code> image without the <code class="docutils literal notranslate"><span class="pre">artifactory.falois.com:5004/</span></code>
prefix, for convenience.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker tag artifactory.galois.com:5004/mate-dev:master mate-dev
</pre></div>
</div>
<p>Clone the MATE repository, including its submodules.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>git clone --recurse-submodules git@gitlab-ext.galois.com:mate/MATE.git
</pre></div>
</div>
<p>Enter the MATE source tree. We use the source tree as a build context, so
we need to be in it for subsequent steps.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">cd</span> MATE
</pre></div>
</div>
<p>Run the <code class="docutils literal notranslate"><span class="pre">bdist</span></code> target, which actually builds MATE’s core runtime components.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <code class="docutils literal notranslate"><span class="pre">bdist</span></code> build includes a large C++ build that requires at least
8GB of RAM. You may encounter OOM-induced build failures if your development
machine (or Docker environment) doesn’t have sufficient memory.</p>
<p>Alternatively, if increasing the amount of RAM is not feasible, you
may have some luck with reducing the build’s parallelism (e.g. with <code class="docutils literal notranslate"><span class="pre">-j2</span></code>
instead of <code class="docutils literal notranslate"><span class="pre">-j</span></code>) or removing <code class="docutils literal notranslate"><span class="pre">-j</span></code> entirely.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A “release” build of MATE can be produced by passing <code class="docutils literal notranslate"><span class="pre">--release-build</span></code>
to <code class="docutils literal notranslate"><span class="pre">./shake.sh</span></code>. This <em>may</em> result in an even more memory intensive
build phase.</p>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run --rm -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/mate -it mate-dev ./shake.sh -j bdist
</pre></div>
</div>
<p>Build the <code class="docutils literal notranslate"><span class="pre">mate-bdist</span></code> image, which embeds the MATE runtime that we
built in the previous step.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker build --target dist -t mate-dist .
</pre></div>
</div>
</div>
<div class="section" id="useful-options-for-working-with-docker">
<h4>Useful options for working with Docker<a class="headerlink" href="#useful-options-for-working-with-docker" title="Permalink to this headline">¶</a></h4>
<ul class="simple">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">--rm</span></code> to remove the container after you stop it</p></li>
<li><p>To run a single command inside Docker and exit, remove the <code class="docutils literal notranslate"><span class="pre">-it</span></code> flag and
add the command to run, i.e. <code class="docutils literal notranslate"><span class="pre">./shake.sh</span></code> to the end of the <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>
incantation.</p></li>
</ul>
</div>
<div class="section" id="run-the-build">
<h4>Run the build<a class="headerlink" href="#run-the-build" title="Permalink to this headline">¶</a></h4>
<p>If you followed the quickstart above, you should have an initial build of MATE
available.</p>
<p>To re-build MATE with any changes you’ve made, just re-run the <code class="docutils literal notranslate"><span class="pre">bdist</span></code> and
<code class="docutils literal notranslate"><span class="pre">mate-dist</span></code> steps:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker run --rm -v <span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>:/mate -it mate-dev ./shake.sh -j bdist
docker build --target dist -t mate-dist .
</pre></div>
</div>
<p>For guidance on how to analyze a program with MATE, check out the
<a class="reference external" href="doc/tutorial.rst">tutorial</a>.</p>
</div>
</div>
<div class="section" id="hacking-on-the-mate-ui">
<h3>Hacking on the MATE UI<a class="headerlink" href="#hacking-on-the-mate-ui" title="Permalink to this headline">¶</a></h3>
<p>MATE’s current UI is a web application, based on React and written in TypeScript.</p>
<p>It is decoupled from the rest of the MATE codebase, using only the REST API
exposed by the MATE server.</p>
<p>For local development, the <code class="docutils literal notranslate"><span class="pre">docker-compose.ui.dev.yml</span></code> compose file provides
hot reloading of the UI. You can run it in conjunction with the main
<code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> file to bring up the entire MATE stack at once:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose.yml -f docker-compose.ui.dev.yml up
</pre></div>
</div>
<p>Alternatively, if you already have the core MATE services running, you can
run just the <code class="docutils literal notranslate"><span class="pre">ui</span></code> service:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker-compose -f docker-compose.yml -f docker-compose.ui.dev.yml up ui
</pre></div>
</div>
</div>
</div>
<div class="section" id="development-practices">
<h2>Development practices<a class="headerlink" href="#development-practices" title="Permalink to this headline">¶</a></h2>
<p>This section collects the practices that the whole MATE team has agreed to
uphold. These practices continue to develop as we work together. The two major
goals of these practices are:</p>
<ol class="arabic simple">
<li><p>To ease the maintenance of MATE in the long term</p></li>
<li><p>To reduce the potential for friction and inefficiency as a result of
mismatched expectations</p></li>
</ol>
<p>To attend to (2), we need to agree on how consistently we uphold each of these
practices. In the following sections, the word <em>consistently</em> will prefix
practices that we do almost always, and
<em>aspirationally</em> will be used for ones that aren’t necessarily expected, but are
nice to do. Some of these are <em>invariably</em> enforced, meaning that compliance
is guaranteed by some automated mechanism (usually a Gitlab setting).</p>
<div class="section" id="documenting-development-practices">
<h3>Documenting development practices<a class="headerlink" href="#documenting-development-practices" title="Permalink to this headline">¶</a></h3>
<p><em>Consistently</em>: documenting our development practices in writing ensures we’re
all on the same page. Changes to the practices should be reflected in this
document, and should be approved by the whole team.</p>
</div>
<div class="section" id="using-gitlab">
<h3>Using Gitlab<a class="headerlink" href="#using-gitlab" title="Permalink to this headline">¶</a></h3>
<div class="section" id="mrs">
<h4>MRs<a class="headerlink" href="#mrs" title="Permalink to this headline">¶</a></h4>
<p><em>Invariably</em>: Code is added to the master branch exclusively through merge
requests (MRs). In practice this means developing on a branch off of master
and opening a MR based on that branch.</p>
<p><em>Aspirationally</em>: MRs link to relevant <a class="reference internal" href="#issues"><span class="std std-ref">issues</span></a>,
especially ones that should be considered “done” once the MR is merged. This
helps us track exactly when and how issues got fixed.</p>
<div class="section" id="assigning-reviewers">
<span id="mr-review"></span><h5>Assigning reviewers<a class="headerlink" href="#assigning-reviewers" title="Permalink to this headline">¶</a></h5>
<p><em>Consistently</em>: Every MR is assigned to one or more collaborators
for <a class="reference internal" href="#code-review"><span class="std std-ref">review</span></a>. The assignee tends to be, but doesn’t have to
be, someone familiar with that part of the codebase. When assigning the
reviewers, the MR author should ping them in the <code class="docutils literal notranslate"><span class="pre">~review-requests</span></code> channel
on Mattermost, and should do so every time the MR is ready for another round
of reviews. One approval is required before merging. The assignee should
review within a business day, or reassign the MR to someone else. Unless the
author needs specific feedback from the assignee(s), it’s OK to merge if a
collaborator other than the assignee(s) reviews the MR.</p>
</div>
<div class="section" id="squashing">
<h5>Squashing<a class="headerlink" href="#squashing" title="Permalink to this headline">¶</a></h5>
<p><em>Aspirationally</em>: To preserve a clean Git history (see also <a class="reference internal" href="#git"><span class="std std-ref">Using Git</span></a>), we
often squash the many commits added to a MR during the review/test cycle into
one commit on the master branch. However, it is not a requirement to squash
commits, and in fact it can be detrimental to a meaningful Git history to
squash together unrelated changes (e.g. one commit that is purely
organizational with one that changes functionality or fixes a bug). MR authors
should use their best judgement, and
<a class="reference internal" href="#mr-labels"><span class="std std-ref">label the MR appropriately</span></a>.</p>
<p><em>Consistently</em>: As a rule, each commit on a non-squashed MR should pass CI, i.e.
each commit on the master branch should always build and pass tests.</p>
</div>
<div class="section" id="rebasing">
<h5>Rebasing<a class="headerlink" href="#rebasing" title="Permalink to this headline">¶</a></h5>
<p><em>Invariably</em>: Every MR has to be rebased against the current master branch
(Gitlab conveniently provides a button for doing this). This ensures that the
MR is run with the latest tests, and that another recently merged MR didn’t
subtly conflict with it. Unfortunately, it also means that all the tests need
to run again, and they can take a while.</p>
<p><em>Aspirationally</em>: After rebasing a branch, the rebaser should cancel any ongoing
CI runs for that same MR. This helps reduce load on the CI runners, speeding
up other builds.</p>
</div>
<div class="section" id="merging">
<h5>Merging<a class="headerlink" href="#merging" title="Permalink to this headline">¶</a></h5>
<p><em>Consistently</em>: The author of the MR hits the merge button after it has been
approved. This prevents merging in code that may be approved but that the
author may wish to make more changes to before merging. Reviewers can hit the
merge button for trivial changes but should generally defer to the author.</p>
<p><a class="reference internal" href="#mr-labels"><span class="std std-ref">The section on MR labels</span></a> describes how the author can
indicate that the MR is ready to be merged.</p>
</div>
<div class="section" id="mr-labels">
<span id="id1"></span><h5>MR Labels<a class="headerlink" href="#mr-labels" title="Permalink to this headline">¶</a></h5>
<p><em>Aspirationally</em>: When an MR has been approved by a reviewer and is ready to
merge, the author should add the <code class="docutils literal notranslate"><span class="pre">MR-ready/squash</span></code> or <code class="docutils literal notranslate"><span class="pre">MR-ready/no-squash</span></code>
labels, indicating that the MR is ready to be merged, and that other
collaborators should rebase it and merge it if another MR is merged first.</p>
<p>See also <a class="reference internal" href="#issue-labels"><span class="std std-ref">the section on issue labels</span></a>.</p>
</div>
<div class="section" id="wip-mrs">
<h5>WIP MRs<a class="headerlink" href="#wip-mrs" title="Permalink to this headline">¶</a></h5>
<p><em>Aspirationally</em>: If your MR is not ready for a full review and merge, but you’d
like someone to have a head start on looking at your progress, prefix the
title of the MR with “WIP:”, and remove this prefix and notify the asignee
(s) when it is ready for review.</p>
</div>
<div class="section" id="issues">
<h5>Issues<a class="headerlink" href="#issues" title="Permalink to this headline">¶</a></h5>
<p><em>Aspirationally</em>: We use issues to track bugs, plan features, and as a forum for
discussions. Creating issues and assigning them to yourself helps others know
what you’re up to, and prevents duplication of effort.</p>
</div>
<div class="section" id="issue-labels">
<span id="id2"></span><h5>Issue Labels<a class="headerlink" href="#issue-labels" title="Permalink to this headline">¶</a></h5>
<dl class="simple">
<dt><em>Aspirationally</em>: There are a few labels that indicate the priority of issues.</dt><dd><p>These are helpful for searching and sorting issues, especially
in <a class="reference internal" href="#milestones"><span class="std std-ref">milestones</span></a>. Collaborators should create and use
additional Gitlab labels however they find helpful.</p>
</dd>
</dl>
</div>
<div class="section" id="milestones">
<span id="id3"></span><h5>Milestones<a class="headerlink" href="#milestones" title="Permalink to this headline">¶</a></h5>
<p><em>Aspirationally</em>: We assign issues and MRs to milestones to track our progress,
ensure necessary functionality and fixes get merged before releases, and to
align our development with the Statement of Work.</p>
</div>
</div>
</div>
<div class="section" id="code-review">
<span id="id4"></span><h3>Code review<a class="headerlink" href="#code-review" title="Permalink to this headline">¶</a></h3>
<p>We have no specific practices surrounding code review (other than <a class="reference internal" href="#mr-review"><span class="std std-ref">a review
is required for each MR</span></a>). See also <a class="reference internal" href="#further-reading"><span class="std std-ref">Further reading</span></a>.</p>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h3>
<p><em>Aspirationally</em>: We generally expect that code added to MATE has at least one
associated unit test, i.e., a test that specifically exercises the new
functionality, independently from as much other code as possible. These tests
run in CI on every merge request.</p>
</div>
<div class="section" id="using-git">
<span id="git"></span><h3>Using Git<a class="headerlink" href="#using-git" title="Permalink to this headline">¶</a></h3>
<div class="section" id="commit-messages">
<h4>Commit messages<a class="headerlink" href="#commit-messages" title="Permalink to this headline">¶</a></h4>
<p><em>Aspirationally</em>: We strive for meaningful commit messages. It’s especially
important to review the commit message that Gitlab will add to your MR when
squashing (sometimes it makes a weird choice).</p>
</div>
</div>
<div class="section" id="linting-and-formatting">
<h3>Linting and formatting<a class="headerlink" href="#linting-and-formatting" title="Permalink to this headline">¶</a></h3>
<p><em>Invariably</em>: All code introduced in MATE passes a suite of linters and
formatters. These tools are integrated with the Shake build system, so
developers can run the following:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./shake.sh lint
./shake.sh format
</pre></div>
</div>
<p>to lint and auto-format their code, respectively.</p>
<p>Automatically formatting the code has a few advantages.</p>
<ul class="simple">
<li><p>It ensures consistency in style across our codebase, hopefully making the code
more readable.</p></li>
<li><p>It saves developer time, because you need to spend less time fixing up your
hastily-written scripts to look nice.</p></li>
<li><p>It reduces friction during code reviews, because disagreement about how code
should be formatted is front-loaded in the selection and configuration of a
formatting tool.</p></li>
</ul>
<p>Linting shares many of the same advantages with respect to readability, but also
helps us avoid common bugs, such as type errors.</p>
<div class="section" id="mypy">
<h4>Mypy<a class="headerlink" href="#mypy" title="Permalink to this headline">¶</a></h4>
<p><em>Aspirationally</em>: When possible, adding Mypy-compatible type annotations makes
the code easier to refactor, communicates the author’s intentions, and catches
some type errors at lint-time (rather than at run-time). Sometimes it’s not
possible or worth the effort to add type annotations to code, due to the
limitations of Mypy’s type system (for example, in <code class="docutils literal notranslate"><span class="pre">mate_query.cpg.models</span></code>).</p>
</div>
</div>
<div class="section" id="further-reading">
<span id="id5"></span><h3>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h3>
<p>Galwegians interested in learning more about internally-recommended software
engineering practices should take a look at the <a class="reference external" href="http://wiki.galois.com/trac/galois/wiki/Engineering/Practices/Software">the relevant wiki page</a>.</p>
<p>In particular, engineers at Galois have identified the following pages as good
resources for code reviewers.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://medium.com/palantir/code-review-best-practices-19e02780015f">Palantir’s blog post, “Code Review Best Practices”</a></p></li>
<li><p><a class="reference external" href="http://www.processimpact.com/articles/humanizing_reviews.pdf">Karl E. Wiegers’ essay, “Humanizing Peer Reviews”</a></p></li>
</ul>
</div>
</div>
<div class="section" id="documentation">
<h2>Documentation<a class="headerlink" href="#documentation" title="Permalink to this headline">¶</a></h2>
<p>Documentation for MATE is written in <a class="reference external" href="https://www.sphinx-doc.org/en/master/usage/restructuredtext/basics.html#external-links">ReStructured Text</a>, and processed by the
<a class="reference external" href="https://www.sphinx-doc.org/">Sphinx</a> documentation system. Documentation source files are located within
the <code class="docutils literal notranslate"><span class="pre">doc/</span></code> subdirectory of the MATE repository.</p>
<div class="section" id="building">
<h3>Building<a class="headerlink" href="#building" title="Permalink to this headline">¶</a></h3>
<p>The build-system provides a top-level target for building the documentation:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; ./shake.sh doc
</pre></div>
</div>
<p>In addition to rendering the documentation, the <code class="docutils literal notranslate"><span class="pre">doc</span></code> target also
pre-generates the autodoc sources, including the <a class="reference internal" href="schemata/cpg.html#cpg-schema"><span class="std std-ref">CPG</span></a>, <a class="reference internal" href="api/index.html#mate-api-documentation"><span class="std std-ref">API</span></a> and <a class="reference internal" href="cli.html#command-line-tools-reference"><span class="std std-ref">CLI</span></a> references.</p>
<p>Rendered documentation is placed in <code class="docutils literal notranslate"><span class="pre">doc/_build/&lt;format&gt;</span></code> for each of the
output formats, all of which are built each time. To view the built HTML,
simply open the root document in your browser of choice:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; $BROWSER doc/_build/html/index.html
</pre></div>
</div>
<p>Alternatively, the built manual page may be viewed directly in the terminal:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$&gt; MANPATH=doc/_build/man man mate
</pre></div>
</div>
</div>
<div class="section" id="writing">
<h3>Writing<a class="headerlink" href="#writing" title="Permalink to this headline">¶</a></h3>
<p>The steps to writing more documentation are simple: navigate the <a class="reference external" href="toctree">ToC Tree</a> starting from <code class="docutils literal notranslate"><span class="pre">doc/index.rst</span></code> to the most appropriate location
for your contributions, and edit away. You may need to create new <code class="docutils literal notranslate"><span class="pre">.rst</span></code>
files to hold your text; make sure to insert them into the appropriate ToC
trees as you go.</p>
<p>Once you’ve made your edits, rebuild, and make sure your work shows up in all
the relevant indices and tables.</p>
</div>
<div class="section" id="deployment">
<h3>Deployment<a class="headerlink" href="#deployment" title="Permalink to this headline">¶</a></h3>
<p>Documentation from the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch of the MATE repository is automatically
rendered and deployed to the <a class="reference external" href="https://mate.galois.com/">web</a> by CI. Your
edits will need to be merged into master before they show up.</p>
</div>
<div class="section" id="the-json-schemata">
<h3>The JSON schemata<a class="headerlink" href="#the-json-schemata" title="Permalink to this headline">¶</a></h3>
<p>The JSON schemata in <code class="docutils literal notranslate"><span class="pre">./frontend/mate-common/mate_common/schemata</span></code> describe valid contents of the
JSON blobs stored in the database. The <code class="docutils literal notranslate"><span class="pre">edges.json</span></code>  and <code class="docutils literal notranslate"><span class="pre">nodes.json</span></code> files
specify each kind of node and edge in the CPG along with their required and
optional fields. This information can also be found in
<code class="docutils literal notranslate"><span class="pre">frontend/mate-common/mate_common/models/cpg_types/mate.py</span></code> which codifies
these structures so they can be used in the query interface.</p>
</div>
<div class="section" id="the-wiki">
<h3>The Wiki<a class="headerlink" href="#the-wiki" title="Permalink to this headline">¶</a></h3>
<p>Some information can be found on <a class="reference external" href="https://gitlab-ext.galois.com/mate/MATE/-/wikis/home">the project wiki</a>, including design
documentation for a few features:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://gitlab-ext.galois.com/mate/MATE/-/wikis/Design:-Directed-Symbolic-Execution">Directed Symbolic Execution with Mantiserve and the CPG</a></p></li>
</ul>
</div>
<div class="section" id="capitalization-conventions">
<h3>Capitalization conventions<a class="headerlink" href="#capitalization-conventions" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>MATE is the name of our project, <code class="docutils literal notranslate"><span class="pre">mate</span></code> is the name of the legacy CLI tool
and the primary Python package</p></li>
<li><p>Python, SQLAlchemy, etc. are proper names and need capitalization</p></li>
<li><p>JSON, SQL, POI, etc. are abbreviations and need capitalization</p></li>
</ul>
</div>
</div>
<div class="section" id="adding-a-new-model-to-the-cpg">
<h2>Adding a new model to the CPG<a class="headerlink" href="#adding-a-new-model-to-the-cpg" title="Permalink to this headline">¶</a></h2>
<div class="section" id="considerations">
<h3>Considerations<a class="headerlink" href="#considerations" title="Permalink to this headline">¶</a></h3>
<p>Before committing to adding a new CPG model, consider the following:</p>
<ol class="arabic simple">
<li><p>Does your feature need its own (node or edge) kind and corresponding model,
or can it be attached to a pre-existing model?</p></li>
<li><p>If adding a new node kind, will new edge kinds be required?</p></li>
</ol>
</div>
<div class="section" id="changes">
<h3>Changes<a class="headerlink" href="#changes" title="Permalink to this headline">¶</a></h3>
<div class="section" id="enumerations">
<h4>Enumerations<a class="headerlink" href="#enumerations" title="Permalink to this headline">¶</a></h4>
<p>In <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/cpg/types/mate.py</span></code>, update the <code class="docutils literal notranslate"><span class="pre">NodeKind</span></code> or <code class="docutils literal notranslate"><span class="pre">EdgeKind</span></code>
enum (or both, if adding both nodes and edges) to contain your new kinds.</p>
<div class="section" id="nodes">
<h5>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h5>
<p>If adding a new node whose kind is <code class="docutils literal notranslate"><span class="pre">Foo</span></code>, you might add the following to
<code class="docutils literal notranslate"><span class="pre">NodeKind</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FOO</span> <span class="o">=</span> <span class="s2">&quot;Foo&quot;</span>
</pre></div>
</div>
<p>Once you’ve updated the <code class="docutils literal notranslate"><span class="pre">NodeKind</span></code> enum, you should also:</p>
<ul>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">NODE_PROVENANCE</span></code> map to reflect the MATE component responsible
for the node’s contents.</p></li>
<li><p>If appropriate, update one or more of the node sets (e.g.
<code class="docutils literal notranslate"><span class="pre">CONSTANT_NODES</span></code>, <code class="docutils literal notranslate"><span class="pre">INSTRUCTION_NODES</span></code>, etc.) that the new node belongs to.
Not all nodes have a set, so this step may not be necessary.</p></li>
<li><p>Update the <code class="docutils literal notranslate"><span class="pre">NodeJSON</span></code> enum in the same file to list the new node’s expected
top-level attributes. Attribute names are unique, so you shouldn’t repeat any
enumeration values that happen to already exist.</p>
<blockquote>
<div><p>For example, if <code class="docutils literal notranslate"><span class="pre">Foo</span></code> is expected to contain <code class="docutils literal notranslate"><span class="pre">bar</span></code> and <code class="docutils literal notranslate"><span class="pre">baz</span></code>, you
might add:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">BAR</span> <span class="o">=</span> <span class="s2">&quot;bar&quot;</span>
<span class="n">BAZ</span> <span class="o">=</span> <span class="s2">&quot;baz&quot;</span>
</pre></div>
</div>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="edges">
<h5>Edges<a class="headerlink" href="#edges" title="Permalink to this headline">¶</a></h5>
<p>If adding a new edge whose kind is <code class="docutils literal notranslate"><span class="pre">FooToBar</span></code>, you might add the following to
<code class="docutils literal notranslate"><span class="pre">EdgeKind</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">FOO_TO_BAR</span> <span class="o">=</span> <span class="s2">&quot;FooToBar&quot;</span>
</pre></div>
</div>
<p>Once you’ve updated the <code class="docutils literal notranslate"><span class="pre">EdgeKind</span></code> enum, you should also update one or more
of the edge sets (e.g. <code class="docutils literal notranslate"><span class="pre">POINTS_TO</span></code>, <code class="docutils literal notranslate"><span class="pre">DATA_FLOW_FORWARD_THIN</span></code>, etc.) that
the new edge belongs to. Not all edges have a set, so this step may not
be necessary.</p>
</div>
</div>
<div class="section" id="schemata">
<h4>Schemata<a class="headerlink" href="#schemata" title="Permalink to this headline">¶</a></h4>
<p>Next, you’ll need to update the JSON schemata to reflect your new node and/or
edge kinds.</p>
<p>For new nodes, edit the <code class="docutils literal notranslate"><span class="pre">frontend/mate-common/mate_common/schemata/nodes.json</span></code> file.</p>
<p>For new edges, edit the <code class="docutils literal notranslate"><span class="pre">frontend/mate-common/mate_common/schemata/edges.json</span></code>.</p>
<div class="section" id="new-relationships">
<h5>New relationships<a class="headerlink" href="#new-relationships" title="Permalink to this headline">¶</a></h5>
<p>If your changes include new relationships between nodes (including new edges),
then you’ll likely need to edit two files:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate-common/mate_common/schemata/relationships.json</span></code>: Describes the cardinality
of each <code class="docutils literal notranslate"><span class="pre">EdgeKind</span></code>, i.e. <code class="docutils literal notranslate"><span class="pre">one-to-one</span></code>, <code class="docutils literal notranslate"><span class="pre">one-to-many</span></code>, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">frontend/mate-common/mate_common/schemata/endpoints.json</span></code>: Describes the valid node-node
relationships as connected by edges.</p></li>
</ul>
</div>
</div>
<div class="section" id="adding-the-model">
<h4>Adding the model<a class="headerlink" href="#adding-the-model" title="Permalink to this headline">¶</a></h4>
<p>Finally, we need to add the actual model and connect it to the above
enumerations.</p>
<div class="section" id="adding-nodes">
<h5>Adding Nodes<a class="headerlink" href="#adding-nodes" title="Permalink to this headline">¶</a></h5>
<p>For nodes, add the model to the appropriate file under
<code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/cpg/models/node</span></code>. The appropriate model is determined by the
node’s origin: DWARF-related nodes go under <code class="docutils literal notranslate"><span class="pre">dwarf.py</span></code>, analysis-related
nodes go under <code class="docutils literal notranslate"><span class="pre">analysis</span></code>, and various program ASTs go under <code class="docutils literal notranslate"><span class="pre">ast/</span></code>.</p>
<p>For example, if <code class="docutils literal notranslate"><span class="pre">Foo</span></code> is a binary-level program feature, we might add the
following to <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/cpg/models/node/ast/bin.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Foo</span><span class="p">(</span><span class="n">NodeMixin</span><span class="p">):</span>
    <span class="n">_kind</span> <span class="o">=</span> <span class="n">NodeKind</span><span class="o">.</span><span class="n">FOO</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>See below for examles of adding relationships via the <code class="docutils literal notranslate"><span class="pre">edge_relationship</span></code> API.</p>
<p>Our final step is to expose our model as an attribute on <code class="docutils literal notranslate"><span class="pre">BaseCPG</span></code>, which is
defined in <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/cpg/models/core/cpg.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BaseCPG</span><span class="p">:</span>

  <span class="n">Foo</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">Foo</span><span class="p">]</span>

  <span class="c1"># further down, in _attach_node_models:</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">Foo</span> <span class="o">=</span> <span class="n">make_node_class</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Node</span><span class="p">,</span> <span class="n">_Foo</span><span class="p">)</span>

  <span class="c1"># even further down:</span>

  <span class="bp">self</span><span class="o">.</span><span class="n">_node_model_classes</span> <span class="o">=</span> <span class="p">[</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ASMBlock</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Foo</span><span class="p">,</span>
  <span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="adding-edges">
<h5>Adding Edges<a class="headerlink" href="#adding-edges" title="Permalink to this headline">¶</a></h5>
<p>For edges, you don’t need to modify the <code class="docutils literal notranslate"><span class="pre">BaseCPG</span></code>. However, if you’d like
attributes to show up on nodes based on their connecting edges, you’ll
need to describe their relationships using <code class="docutils literal notranslate"><span class="pre">edge_relationship</span></code>.</p>
<p>For example, here’s how an <code class="docutils literal notranslate"><span class="pre">ASMGlobalVariable</span></code> is connected to its
<code class="docutils literal notranslate"><span class="pre">DWARFType</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@declared_attr</span>
<span class="k">def</span> <span class="nf">dwarf_type</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RelationshipProperty</span><span class="p">:</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">edge_relationship</span><span class="p">(</span>
        <span class="n">EdgeKind</span><span class="o">.</span><span class="n">HAS_DWARF_TYPE</span><span class="p">,</span> <span class="bp">cls</span><span class="o">.</span><span class="n">cpg</span><span class="o">.</span><span class="n">DWARFType</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="s2">&quot;global_variables&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">backref</span></code> is the same as SQLAlchemy, meaning that this code produces two
new APIs:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">global_var</span><span class="o">.</span><span class="n">dwarf_type</span>      <span class="c1"># =&gt; DWARFType</span>
<span class="n">some_type</span><span class="o">.</span><span class="n">global_variables</span> <span class="c1"># =&gt; [ASMGlobalVariable]</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="adding-a-poi-query">
<h2>Adding a POI Query<a class="headerlink" href="#adding-a-poi-query" title="Permalink to this headline">¶</a></h2>
<p>Here’s a checklist of things to think about when adding a POI query:</p>
<ul class="simple">
<li><p>Add a test program and accompanying test harness. Optimally, this program will
have true positives, false positives (where static information is insufficient
or the query could stand to be improved), true negatives, and false negatives.</p></li>
<li><p>Add the new query to the tests in
<code class="docutils literal notranslate"><span class="pre">/home/langston/code/mate/side/tests/integration/poi/test_pois.py</span></code>.</p></li>
<li><p>Test running the POI query on some mid-size programs to ensure it’s
sufficiently performant.</p></li>
<li><p>Consider whether there are opportunities to push work from Python into the
database (which is generally way faster).</p></li>
<li><p>Consider the directionality of your queries - are there reasons to think that
forwards or reverse queries might be more performant or precise?</p></li>
<li><p>Consider how your queries do or don’t make use of context-sensitivity in the
CPG - context-sensitivity can help build much more precise queries!</p></li>
</ul>
</div>
<div class="section" id="querying-the-sql-db-directly">
<h2>Querying the SQL DB Directly<a class="headerlink" href="#querying-the-sql-db-directly" title="Permalink to this headline">¶</a></h2>
<p>It can be instructive to directly query the SQL database that stores the MATE
CPG and other runtime state. After bringing up the MATE DB with
<code class="docutils literal notranslate"><span class="pre">docker-compose</span></code>, try the following to list the tables in the database
(replacing <code class="docutils literal notranslate"><span class="pre">mate_db_1</span></code> with the appropriate container name):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>docker <span class="nb">exec</span> -it mate_db_1 psql --username<span class="o">=</span>mate --command<span class="o">=</span><span class="s1">&#39;\dt&#39;</span>
</pre></div>
</div>
<p>You can then attempt the following queries, replacing <code class="docutils literal notranslate"><span class="pre">nodes</span></code> or <code class="docutils literal notranslate"><span class="pre">edges</span></code> by
some specific build’s node or edge table (which will look something like
<code class="docutils literal notranslate"><span class="pre">edges_9b71d8a6f09c43989785682196f98bfd</span></code>).</p>
<div class="section" id="listing-nodes-edges">
<h3>Listing Nodes/Edges<a class="headerlink" href="#listing-nodes-edges" title="Permalink to this headline">¶</a></h3>
<p>You can list all the nodes or edges in a graph by issuing direct table
scans. Use <code class="docutils literal notranslate"><span class="pre">limit</span></code> to only see a sample.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="k">FROM</span><span class="w"> </span><span class="n">edges</span><span class="w"> </span><span class="k">LIMIT</span><span class="w"> </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="filtering-on-node-edge-attributes">
<h3>Filtering on Node/Edge Attributes<a class="headerlink" href="#filtering-on-node-edge-attributes" title="Permalink to this headline">¶</a></h3>
<p>To restrict your listing to specific attributes, add a <code class="docutils literal notranslate"><span class="pre">where</span></code> clause
and use <code class="docutils literal notranslate"><span class="pre">json_extract</span></code>.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"></span>
<span class="w">    </span><span class="o">*</span><span class="w"></span>
<span class="k">FROM</span><span class="w"></span>
<span class="w">    </span><span class="n">edges</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"></span>
<span class="w">    </span><span class="n">json_extract</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.edge_kind&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="w"></span>
<span class="k">LIMIT</span><span class="w"></span>
<span class="w">    </span><span class="mi">20</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<p>Documentation on how to manipulate JSON can be found in the <a class="reference external" href="https://www.sqlite.org/json1.html">SQLite
Documentation</a>.</p>
</div>
<div class="section" id="statically-sized-joins">
<h3>Statically-Sized Joins<a class="headerlink" href="#statically-sized-joins" title="Permalink to this headline">¶</a></h3>
<p>To join a known number of tables, use them together in a <code class="docutils literal notranslate"><span class="pre">WHERE</span></code>
clause.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span><span class="w"></span>
<span class="w">    </span><span class="n">json_extract</span><span class="p">(</span><span class="n">sources</span><span class="p">.</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.llvm_type&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">source_type</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">json_extract</span><span class="p">(</span><span class="n">targets</span><span class="p">.</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.llvm_type&#39;</span><span class="p">)</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">target_type</span><span class="w"></span>
<span class="k">FROM</span><span class="w"></span>
<span class="w">    </span><span class="n">nodes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">sources</span><span class="p">,</span><span class="w"> </span><span class="n">edges</span><span class="p">,</span><span class="w"> </span><span class="n">nodes</span><span class="w"> </span><span class="k">AS</span><span class="w"> </span><span class="n">targets</span><span class="w"></span>
<span class="k">WHERE</span><span class="w"></span>
<span class="w">    </span><span class="n">sources</span><span class="p">.</span><span class="n">uuid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edges</span><span class="p">.</span><span class="k">source</span><span class="w"></span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">edges</span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targets</span><span class="p">.</span><span class="n">uuid</span><span class="w"></span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">json_extract</span><span class="p">(</span><span class="n">sources</span><span class="p">.</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.llvm_type&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;i32&#39;</span><span class="w"></span>
<span class="w">    </span><span class="k">AND</span><span class="w"> </span><span class="n">json_extract</span><span class="p">(</span><span class="n">edges</span><span class="p">.</span><span class="n">attributes</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;$.edge_kind&#39;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">11</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
</div>
<div class="section" id="path-queries">
<h3>Path Queries<a class="headerlink" href="#path-queries" title="Permalink to this headline">¶</a></h3>
<p>Path queries involve joining the edge table multiple times, with itself.
This can be expensive; thankfully, we can use recursive common-table
expressions (CTEs) to express this (relatively) concisely.</p>
<p>The following query constructs a table of all paths between any pair of
vertices.</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="c1">-- Definition of recursive CTE</span>
<span class="k">with</span><span class="w"> </span><span class="k">recursive</span><span class="w"> </span><span class="n">paths</span><span class="p">(</span><span class="k">source</span><span class="p">,</span><span class="w"> </span><span class="n">target</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="p">(</span><span class="w"></span>
<span class="w">  </span><span class="c1">-- Base Case</span>
<span class="w">  </span><span class="k">select</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">json_array</span><span class="p">(</span><span class="n">uuid</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">nodes</span><span class="w"></span>

<span class="w">  </span><span class="k">union</span><span class="w"></span>

<span class="w">  </span><span class="c1">-- Recursive Case</span>
<span class="w">  </span><span class="k">select</span><span class="w"></span>
<span class="w">    </span><span class="n">paths</span><span class="p">.</span><span class="k">source</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">edges</span><span class="p">.</span><span class="n">target</span><span class="p">,</span><span class="w"></span>

<span class="w">    </span><span class="c1">-- Cycle-breaking</span>
<span class="w">    </span><span class="n">json_insert</span><span class="p">(</span><span class="w"></span>
<span class="w">      </span><span class="n">paths</span><span class="p">.</span><span class="n">path</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="s1">&#39;$[&#39;</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">json_array_length</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="w"></span>
<span class="w">      </span><span class="n">edges</span><span class="p">.</span><span class="n">target</span><span class="w"></span>
<span class="w">    </span><span class="p">)</span><span class="w"></span>
<span class="w">  </span><span class="k">from</span><span class="w"> </span><span class="n">paths</span><span class="p">,</span><span class="w"> </span><span class="n">edges</span><span class="w"></span>
<span class="w">  </span><span class="k">where</span><span class="w"> </span><span class="n">paths</span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">edges</span><span class="p">.</span><span class="k">source</span><span class="w"></span>
<span class="w">    </span><span class="k">and</span><span class="w"> </span><span class="n">edges</span><span class="p">.</span><span class="n">target</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">value</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">json_each</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">path</span><span class="p">))</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
<span class="c1">-- Usage of recursive CTE</span>
<span class="k">select</span><span class="w"></span>
<span class="w">  </span><span class="k">source</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="n">target</span><span class="p">,</span><span class="w"></span>

<span class="w">  </span><span class="c1">-- Prettify JSON path, not strictly necessary.</span>
<span class="w">  </span><span class="p">(</span><span class="k">select</span><span class="w"> </span><span class="n">group_concat</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">json_each</span><span class="p">(</span><span class="n">paths</span><span class="p">.</span><span class="n">path</span><span class="p">))</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">path</span><span class="w"></span>
<span class="k">from</span><span class="w"> </span><span class="n">paths</span><span class="p">;</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="extensions">
<h4>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h4>
<p>There are multiple ways in which this query can be refined:</p>
<ul>
<li><p>If you will be doing multiple queries over the computed paths, you
should probably store them in a table.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>create table paths as with recursive …;
</pre></div>
</div>
<p>This approach will often be better than recomputing the query with
additional constraints, as below, if there are enough of them.</p>
</li>
<li><p>If you do not require paths between <strong>all</strong> pairs of vertices, you
can add a <code class="docutils literal notranslate"><span class="pre">where</span></code> clause to the base case of the query to restrict
the set of entry points.</p></li>
<li><p>If you want to compute all paths <strong>not</strong> passing through a given
vertex, you have several options:</p>
<ol class="arabic simple">
<li><p>Compute all paths, and filter them on the path afterwards. This
will be faster if you have precomputed the paths already.</p></li>
<li><p>Add a <code class="docutils literal notranslate"><span class="pre">where</span></code> clause to the recursive case of the query to stop
it from exploring the given vertex.</p></li>
</ol>
</li>
</ul>
</div>
<div class="section" id="shortcomings">
<h4>Shortcomings<a class="headerlink" href="#shortcomings" title="Permalink to this headline">¶</a></h4>
<p>Pretty much any kind of query you like can be expressed as a combination
of an all-paths query, followed by a filtering. However, some kinds of
queries won’t really scale with this approach.</p>
<p>For example, CFL-reachability can only really be answered by computing
<strong>all</strong> paths, and piping them out to a separate program to do the CF
filtering. Ideally, we would like to pre-emptively prune any path that
will not be accepted by the CFL, but SQL won’t support this since it
can’t maintain state very easily.</p>
</div>
</div>
</div>
<div class="section" id="internal-state-machines">
<h2>Internal state machines<a class="headerlink" href="#internal-state-machines" title="Permalink to this headline">¶</a></h2>
<p>MATE executes a variety of asynchronous tasks internally, the majority
of which are implemented in <code class="docutils literal notranslate"><span class="pre">mate.tasks</span></code> (i.e., under <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/tasks</span></code>).</p>
<p>Nearly all tasks are modeled as state machines, with a limited number of valid
transitions between states. Each is shown below, with terminal states highlighted
in red.</p>
<a class="reference external image-reference" href="./schemata/statemachine.AnalysisTaskState.png"><img alt="State transition diagram for AnalysisTaskState nodes" src="schemata/statemachine.AnalysisTaskState.png" /></a>
<a class="reference external image-reference" href="./schemata/statemachine.BuildState.png"><img alt="State transition diagram for BuildState nodes" src="schemata/statemachine.BuildState.png" /></a>
<a class="reference external image-reference" href="./schemata/statemachine.CompilationState.png"><img alt="State transition diagram for CompilationState nodes" src="schemata/statemachine.CompilationState.png" /></a>
<a class="reference external image-reference" href="./schemata/statemachine.MantiserveTaskState.png"><img alt="State transition diagram for MantiserveTaskState nodes" src="schemata/statemachine.MantiserveTaskState.png" /></a>
</div>
<div class="section" id="ci-and-git-branches">
<h2>CI and Git Branches<a class="headerlink" href="#ci-and-git-branches" title="Permalink to this headline">¶</a></h2>
<div class="section" id="background">
<h3>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h3>
<p>MATE has a large test suite, ranging from unit tests of small pure functions to
whole-system integraion tests running in Docker Compose. However, more tests
running on every commit are not <em>always</em> better. We have to balance the
trade-off between the additional assurance granted by running more tests
against the time they take to run. The central concerns to take care of when
considering this balance are:</p>
<ul class="simple">
<li><p>Level of assurance for deliverables to the client</p></li>
<li><p>Depth of features in deliverables to the client</p></li>
<li><p>Developer productivity and happiness</p></li>
</ul>
<p>(None of these concerns correspond directly to more/slower tests or fewer/faster
tests.)</p>
</div>
<div class="section" id="implementation">
<h3>Implementation<a class="headerlink" href="#implementation" title="Permalink to this headline">¶</a></h3>
<p>Development of MATE happens in merge requests against the <code class="docutils literal notranslate"><span class="pre">master</span></code> branch,
which has a suite of tests that run on every commit. MATE has enough
long-running tests that it’s not feasible to run all of them against every
commit before merging to <code class="docutils literal notranslate"><span class="pre">master</span></code>. Therefore, <code class="docutils literal notranslate"><span class="pre">master</span></code> is periodically
merged into the <code class="docutils literal notranslate"><span class="pre">stable</span></code> branch, and the following script decides when to run
a longer, more complete suite of tests:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/sh</span>

<span class="c1"># Test script to see if we&#39;re in a CI pipeline that should run integration</span>
<span class="c1"># tests, optimize heavily, etc.</span>
<span class="c1">#</span>
<span class="c1"># Specifically, will exit 0 (true) if:</span>
<span class="c1">#</span>
<span class="c1"># 1. this is a MR into stable,</span>
<span class="c1"># 2. this is a commit on stable, or</span>
<span class="c1"># 3. this is a pipeline inside a schedule (indicating a once-a-day pipeline on</span>
<span class="c1">#    master).</span>
<span class="c1">#</span>
<span class="c1"># This script should be kept in sync with the &quot;rules:&quot; clause of the</span>
<span class="c1"># &quot;.on-stable:&quot; configuration in .gitlab-ci.yml.</span>

<span class="nb">set</span> -x

<span class="k">if</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CI_MERGE_REQUEST_TARGET_BRANCH_NAME</span><span class="k">:-</span><span class="nv">fake</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;stable&quot;</span> <span class="o">]</span> <span class="se">\</span>
  <span class="o">||</span> <span class="o">[</span> <span class="s2">&quot;</span><span class="si">${</span><span class="nv">CI_COMMIT_BRANCH</span><span class="k">:-</span><span class="nv">fake</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">=</span> <span class="s2">&quot;stable&quot;</span> <span class="o">]</span> <span class="se">\</span>
  <span class="o">||</span> <span class="o">[</span> -n <span class="s2">&quot;</span><span class="si">${</span><span class="nv">SCHEDULE</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
  <span class="nb">exit</span> <span class="m">0</span>
<span class="k">fi</span>
<span class="nb">exit</span> <span class="m">1</span>
</pre></div>
</div>
<p>Specifically, when the above script exits with 0,</p>
<ul class="simple">
<li><p>The environment variable <code class="docutils literal notranslate"><span class="pre">MATE_INTEGRATION_TESTS</span></code> is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> before
running <code class="docutils literal notranslate"><span class="pre">pytest</span></code>, which causes more tests to be run and with slightly
different settings,</p></li>
<li><p>All C++ components of MATE are built with the Clang Static Analyzer</p></li>
<li><p>All C++ components of MATE are built LLVM’s Address Sanitizer and Undefined
Behavior Sanitizer, and the test suite is run on top of each of these
builds.</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">--release-build</span></code> flag is passed to Shake (see <a class="reference internal" href="#building-releases"><span class="std std-ref">Building Releases</span></a>)</p></li>
</ul>
</div>
<div class="section" id="building-releases">
<h3>Building Releases<a class="headerlink" href="#building-releases" title="Permalink to this headline">¶</a></h3>
<p>Releases are cut from the <code class="docutils literal notranslate"><span class="pre">stable</span></code> branch. The primary release artifact is the
<code class="docutils literal notranslate"><span class="pre">mate-dist</span></code> Docker image that is build by CI and uploaded to the
Galois-maintained Artifactory instance. Release builds are built with Shake’s
<code class="docutils literal notranslate"><span class="pre">--release-build</span></code> flag which</p>
<ul class="simple">
<li><p>Disables assertions so that fewer errors are fatal</p></li>
<li><p>Turns on more aggressive optimization flags which cause build times to
skyrocket but significantly improve performance</p></li>
</ul>
<p>The effect of this flag is predominantly implemented in <code class="docutils literal notranslate"><span class="pre">llvm/CMakeLists.txt</span></code>
and <code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis/CMakeLists.txt</span></code>.</p>
</div>
</div>
<div class="section" id="developing-against-the-chess-system">
<h2>Developing Against the CHESS System<a class="headerlink" href="#developing-against-the-chess-system" title="Permalink to this headline">¶</a></h2>
<p>As described in <a class="reference internal" href="chess-system.html#working-with-the-chess-system"><span class="std std-ref">its sesion</span></a>,
MATE is one component of the larger CHESS System, which includes interoperating
software stacks from all of the performers on the DARPA CHESS Program. This
section describes how to test and interate an in-development version of MATE
against the current deployed version of the CHESS System.</p>
<p>Make sure to go through the <code class="docutils literal notranslate"><span class="pre">README</span></code> in <code class="docutils literal notranslate"><span class="pre">submodules/chess-system</span></code> to get
more specfic and up-to-date information.</p>
<div class="section" id="make-mate-specific-changes">
<h3>Make MATE-Specific Changes<a class="headerlink" href="#make-mate-specific-changes" title="Permalink to this headline">¶</a></h3>
<p>The first round of development occurs in the main MATE repository, consisting of
regular MATE development. In order to be able to have the MATE stack use local
images, modify the <code class="docutils literal notranslate"><span class="pre">submodules/chess-system/docker-compose.mate.yml</span></code> stack
definition to reference the appropriate images, and follow the regular
instructions on running the CHESS System.</p>
<p>Some useful workflows:</p>
<ol class="arabic simple">
<li><p>Any individual stack (such as MATE) can be brought down and up again
independently of the other stacks. If the images referenced by the stack
definition have been rebuilt, the redeployment will use those new images.
(e.g. <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">stack</span> <span class="pre">rm</span> <span class="pre">mate;</span> <span class="pre">docker</span> <span class="pre">build</span> <span class="pre">...;</span> <span class="pre">docker</span> <span class="pre">stack</span> <span class="pre">deploy</span> <span class="pre">...</span>
<span class="pre">mate</span></code></p></li>
<li><p>The logs for any particular service may be viewed through <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">service</span>
<span class="pre">logs</span> <span class="pre">&lt;service-name&gt;</span></code>. 3. Any container run while attached to <code class="docutils literal notranslate"><span class="pre">chess_net</span></code>
will be able to see every other service in the swarm as <code class="docutils literal notranslate"><span class="pre">&lt;stack_service&gt;</span></code>,
and will be able to access any open ports on those containers. 4. Services
in the same stack can refer to each other with just the service name;
services in other stacks must be qualified with <code class="docutils literal notranslate"><span class="pre">&lt;stack_name&gt;_</span></code>.</p></li>
</ol>
<p>As part of this initial MATE-specific MR, do not commit any changes to the
<code class="docutils literal notranslate"><span class="pre">chess-system</span></code> repository.</p>
<p>Once a satisfactory merge request has been reviewed and merged into the master
branch, new images must be pushed out. You will need credentials for Apogee’s
AWS ECR repositories. The tag for these images should be a commit hash on
master representing the state of the code-base desired.</p>
</div>
<div class="section" id="bump-stack-definitions-and-message-schemas">
<h3>Bump stack definitions and message schemas<a class="headerlink" href="#bump-stack-definitions-and-message-schemas" title="Permalink to this headline">¶</a></h3>
<p>The second step is to persist the changes to the <code class="docutils literal notranslate"><span class="pre">chess-system</span></code> repository.
Typically this will only involve updating the image hashes in the MATE stack
definition, but can also involve adding/removing services, etc.</p>
<p>In addition, any new message schemas should be committed to the
<code class="docutils literal notranslate"><span class="pre">chess-messages</span></code> repository.</p>
<p>At the end of this workflow, new commits of both repositories should be pushed
upstream, which will require credentials to Apogee’s GitLab. There is no MR
process in place, since most performers will be only modifying their own stack
definitions.</p>
</div>
<div class="section" id="bump-submodule-revisions-in-mate">
<h3>Bump submodule revisions in MATE<a class="headerlink" href="#bump-submodule-revisions-in-mate" title="Permalink to this headline">¶</a></h3>
<p>Finally, persist the updated submodule revisions in MATE by creating a MATE MR.
This should usually not be more complicated than just the submodule updates.</p>
</div>
</div>
<div class="section" id="pointer-analysis">
<h2>Pointer Analysis<a class="headerlink" href="#pointer-analysis" title="Permalink to this headline">¶</a></h2>
<div class="section" id="running-souffle">
<h3>Running Souffle<a class="headerlink" href="#running-souffle" title="Permalink to this headline">¶</a></h3>
<p>You can run the pointer analysis in the Souffle interpreter with a Shake
target:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">shake</span><span class="o">.</span><span class="n">sh</span> <span class="n">run</span><span class="o">-</span><span class="n">souffle</span> <span class="o">--</span> <span class="o">--</span> <span class="mi">1</span><span class="o">-</span><span class="n">callsite</span> <span class="n">file</span><span class="o">.</span><span class="n">ll</span> <span class="o">&lt;</span><span class="n">additional</span> <span class="n">flags</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The output will be stashed in <code class="docutils literal notranslate"><span class="pre">.out/cache/pointer-analysis</span></code>. N.B. this runs
the analysis in “debug” mode, invoking both the unification analysis and
subset analysis and including all relevant asserts. An individual pointer
analysis can be run (without debug asserts) via <code class="docutils literal notranslate"><span class="pre">run-souffle-unification</span></code> and
<code class="docutils literal notranslate"><span class="pre">run-souffle-subset</span></code> respectively.</p>
<div class="section" id="profiling">
<h4>Profiling<a class="headerlink" href="#profiling" title="Permalink to this headline">¶</a></h4>
<p>Souffle has a <a class="reference external" href="https://github.com/souffle-lang/souffle/issues/1458">history</a>
of <a class="reference external" href="https://github.com/souffle-lang/souffle/issues/1713">issues</a> <a class="reference external" href="https://github.com/souffle-lang/souffle/issues/2217">with</a> its
profiler. So YMMV depending on the most recent release.</p>
<p>You can profile Souffle using the <code class="docutils literal notranslate"><span class="pre">run-souffle</span></code> target above, with the addition of the <code class="docutils literal notranslate"><span class="pre">-p</span></code> flag (if you built Souffle from source, you’ll have to modify the <code class="docutils literal notranslate"><span class="pre">run-souffle</span></code> Shake target to use your patched version of Souffle).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./shake.sh run-souffle -- -- <span class="m">1</span>-callsite your-prog.bc -c -p your-prog-profile.json
souffleprof -j your-prog-profile.json
</pre></div>
</div>
</div>
</div>
<div class="section" id="debugging-the-pointer-analysis-results">
<h3>Debugging the pointer analysis results<a class="headerlink" href="#debugging-the-pointer-analysis-results" title="Permalink to this headline">¶</a></h3>
<p>MATE uses a patched version of
<a class="reference external" href="https://github.com/plast-lab/cclyzer-souffle">cclyzer</a> that stores its CSV
results in a compressed format. As a result, the CSV intermediates produced by
running a CPG build with <code class="docutils literal notranslate"><span class="pre">debug_pointer_analysis=true</span></code> are not initially human
readable.</p>
<p>To decompress the CSV intermediates for manual debugging, you can use
<code class="docutils literal notranslate"><span class="pre">gunzip</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># -c emits to stdout</span>
gunzip -c /path/to/intermediates/whatever.csv.gz
</pre></div>
</div>
<p>The results produced by the pointer analysis itself (from <code class="docutils literal notranslate"><span class="pre">cclyzer</span></code>’s fact
generation) are similarly compressed, and can be decompressed with the same
<code class="docutils literal notranslate"><span class="pre">gunzip</span></code> invocation.</p>
</div>
<div class="section" id="plots">
<h3>Plots<a class="headerlink" href="#plots" title="Permalink to this headline">¶</a></h3>
<p>To evaluate the impact of different context sensitivity strategies, there is
some code to collect and plot statistics generated by the pointer analysis in
<code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis/stats</span></code>.</p>
<p>Here’s an example of how to the program to evaluate three choices of context
sensitivity across a few different input programs. The example works when run
inside the <code class="docutils literal notranslate"><span class="pre">mate-dev</span></code> image, in the repository root:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">llvm</span><span class="o">/</span><span class="n">PointerAnalysis</span><span class="o">/</span><span class="n">stats</span><span class="o">/</span><span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>

<span class="n">python3</span> <span class="n">llvm</span><span class="o">/</span><span class="n">PointerAnalysis</span><span class="o">/</span><span class="n">stats</span><span class="o">/</span><span class="n">stats</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">vv</span> <span class="n">collect</span> \
  <span class="o">--</span><span class="n">fact</span><span class="o">-</span><span class="n">generator</span><span class="o">-</span><span class="n">exe</span><span class="o">=</span><span class="s2">&quot;$PWD/.out/build/llvm/PointerAnalysis/factgen-exe&quot;</span> \
  <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="n">souffle</span><span class="o">-</span><span class="n">arguments</span><span class="o">=</span><span class="s2">&quot;-j8&quot;</span> \
  <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="n">souffle</span><span class="o">-</span><span class="n">arguments</span><span class="o">=</span><span class="s2">&quot;-L .out/build/llvm&quot;</span> \
  <span class="o">--</span><span class="n">extra</span><span class="o">-</span><span class="n">souffle</span><span class="o">-</span><span class="n">arguments</span><span class="o">=</span><span class="s2">&quot;-lFunctors&quot;</span> \
  <span class="o">--</span><span class="n">context</span><span class="o">-</span><span class="n">sensitivity</span><span class="o">=</span><span class="s2">&quot;insensitive&quot;</span> \
  <span class="o">--</span><span class="n">context</span><span class="o">-</span><span class="n">sensitivity</span><span class="o">=</span><span class="s2">&quot;1-callsite&quot;</span> \
  <span class="o">--</span><span class="n">context</span><span class="o">-</span><span class="n">sensitivity</span><span class="o">=</span><span class="s2">&quot;2-callsite&quot;</span> \
  <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">directory</span> \
  <span class="n">llvm</span><span class="o">/</span><span class="n">PointerAnalysis</span><span class="o">/</span><span class="n">datalog</span><span class="o">/</span><span class="n">statistics</span><span class="o">.</span><span class="n">project</span> \
  <span class="n">program1</span><span class="o">.</span><span class="n">bc</span> \
  <span class="n">program2</span><span class="o">.</span><span class="n">ll</span> \
  <span class="n">program3</span><span class="o">.</span><span class="n">ll</span>

<span class="n">python3</span> <span class="n">llvm</span><span class="o">/</span><span class="n">PointerAnalysis</span><span class="o">/</span><span class="n">stats</span><span class="o">/</span><span class="n">stats</span><span class="o">.</span><span class="n">py</span> <span class="o">-</span><span class="n">vv</span> <span class="n">report</span> \
          <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">directory</span> \
          <span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">report</span><span class="o">/</span><span class="n">directory</span>
</pre></div>
</div>
</div>
<div class="section" id="tests">
<h3>Tests<a class="headerlink" href="#tests" title="Permalink to this headline">¶</a></h3>
<p>There are three test suites related to the pointer analysis:</p>
<ul>
<li><p>Tests for the user-defined functors that make up our implementation of context
sensitivity</p>
<blockquote>
<div><ul class="simple">
<li><p>Run with <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">ctest</span></code></p></li>
<li><p>Source is in <code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis/datalog</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>Golden tests, benchmarks, and tests of properties/invariants of the pointer
analysis output</p>
<blockquote>
<div><ul class="simple">
<li><p>Run with <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">pytests</span></code> and <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">bench</span></code></p></li>
<li><p>Source is in <code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis/test</span></code></p></li>
</ul>
</div></blockquote>
</li>
<li><p>The tests and benchmarks of the CPG/query interface that indirectly test the
pointer analysis</p>
<blockquote>
<div><ul class="simple">
<li><p>Run with <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">pytests</span></code> and <code class="docutils literal notranslate"><span class="pre">./shake.sh</span> <span class="pre">bench</span></code></p></li>
<li><p>Source is in <code class="docutils literal notranslate"><span class="pre">frontend/test</span></code></p></li>
</ul>
</div></blockquote>
</li>
</ul>
</div>
</div>
<div class="section" id="publishing-the-mate-packages-to-pypi">
<h2>Publishing the MATE packages to PyPI<a class="headerlink" href="#publishing-the-mate-packages-to-pypi" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps can be performed automatically via the <code class="docutils literal notranslate"><span class="pre">pydists</span></code> target
in the <code class="docutils literal notranslate"><span class="pre">shake</span></code> build:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">docker run --rm -v $(pwd):/mate -it mate-dev:latest ./shake.sh -j pydists</span>
</pre></div>
</div>
<p>When run this way, all distribution files will be written to <code class="docutils literal notranslate"><span class="pre">.out/build/pydist/</span></code>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These steps will become mostly obsolete once MATE is open sourced.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You need to have a PyPI account (and be an owner/publisher of the relevant
package) to follow these steps.</p>
</div>
<p>In general, there are three steps to publishing one of the <code class="docutils literal notranslate"><span class="pre">frontend/</span></code> packages:</p>
<ol class="arabic">
<li><p><em>Install packaging dependencies</em></p>
<blockquote>
<div><p>On your local host:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>pip install -U setuptools wheel build twine
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><em>Build the package</em></p>
<blockquote>
<div><p>Using <code class="docutils literal notranslate"><span class="pre">mate-common</span></code> as an example:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span><span class="nb">cd</span> frontend/mate-common
<span class="gp"># </span>build both <span class="nb">source</span> and binary <span class="o">(</span>wheel<span class="o">)</span> distributions
<span class="gp">$ </span>python -m build --sdist --wheel
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By default, <code class="docutils literal notranslate"><span class="pre">build</span></code> will create <code class="docutils literal notranslate"><span class="pre">build/</span></code> and <code class="docutils literal notranslate"><span class="pre">dist/</span></code> folders in
<code class="docutils literal notranslate"><span class="pre">$CWD</span></code>. This will confuse our linting tools (<code class="docutils literal notranslate"><span class="pre">mypy</span></code> and
<code class="docutils literal notranslate"><span class="pre">bellybutton</span></code>), so you may want to remove them before running any
linting actions.</p>
</div>
<p>Then, confirm that the packages were built as expected:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>ls dist/*
</pre></div>
</div>
</div></blockquote>
</li>
<li><p><em>Publish the package files</em></p>
<blockquote>
<div><p>From the same directory as above:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>twine upload dist/*
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">twine</span></code> will prompt you for your PyPI password, unless you have it
(or an API token) preconfigured.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Make sure that <code class="docutils literal notranslate"><span class="pre">dist/</span></code> has nothing other than the new distribution files
in it; preexisting distribution files will be rejected by PyPI.</p>
</div>
</div></blockquote>
</li>
</ol>
</div>
<div class="section" id="project-infrastructure">
<h2>Project Infrastructure<a class="headerlink" href="#project-infrastructure" title="Permalink to this headline">¶</a></h2>
<p>Galois maintains a Gitlab CI runner for MATE. The configuration of this runner
and other deployment-specific configuration and documentation can be found
here: <a class="reference external" href="https://gitlab-ext.galois.com/mate/deepblue">https://gitlab-ext.galois.com/mate/deepblue</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="testing.html" class="btn btn-neutral float-right" title="Writing and running MATE’s tests" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="analysis.html" class="btn btn-neutral float-left" title="MATE POI Analyses" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2022, The MATE Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>