

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Architecture &mdash; MATE 0.1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Command-Line Tools Reference" href="cli.html" />
    <link rel="prev" title="Notebook Tutorial" href="tutorial-notebooks.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MATE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="tutorial-flowfinder.html">Flowfinder Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial-notebooks.html">Notebook Tutorial</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Architecture</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#analysis-workflow">Analysis Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="#system-architecture">System architecture</a></li>
<li class="toctree-l2"><a class="reference internal" href="#docker-images-and-compositions">Docker Images and Compositions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#docker-images">Docker Images</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#first-party">First-Party</a></li>
<li class="toctree-l4"><a class="reference internal" href="#third-party">Third-Party</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#docker-compositions">Docker Compositions</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#component-index">Component index</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#compilation-components">Compilation components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#blight">blight</a></li>
<li class="toctree-l4"><a class="reference internal" href="#gllvm">GLLVM</a></li>
<li class="toctree-l4"><a class="reference internal" href="#compilation-tasks">Compilation tasks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cpg-generation-components">CPG generation components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#llvm-middle-end-passes">LLVM middle-end passes</a></li>
<li class="toctree-l4"><a class="reference internal" href="#points-to-analysis">Points-to analysis</a></li>
<li class="toctree-l4"><a class="reference internal" href="#machine-code-mapping-tools">Machine-code mapping tools</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-tasks">Build tasks</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#analysis-components">Analysis components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cpg-query-api">CPG Query API</a></li>
<li class="toctree-l4"><a class="reference internal" href="#context-free-language-reachability-queries">Context-free language reachability queries</a></li>
<li class="toctree-l4"><a class="reference internal" href="#poi-framework">POI framework</a></li>
<li class="toctree-l4"><a class="reference internal" href="#poi-analyses">POI analyses</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#user-interface-components">User interface components</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#ui-client-and-flowfinder">ui-client and Flowfinder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#mantiserve">Mantiserve</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Tools Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-overview.html">CLI Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpg.html">The Code Property Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging-builds.html">Debugging Program Build Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="dwarfcore.html">Dwarfcore</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment variables in the MATE container</a></li>
<li class="toctree-l1"><a class="reference internal" href="mantiserve.html">Mantiserve</a></li>
<li class="toctree-l1"><a class="reference internal" href="pois.html">Points of Interest</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemata/cpg.html">CPG Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">MATE Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">Traces</a></li>
<li class="toctree-l1"><a class="reference internal" href="under-constrained-manticore.html">Under-constrained Manticore</a></li>
<li class="toctree-l1"><a class="reference internal" href="usagefinder.html">UsageFinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-flowfinder.html">Using Flowfinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-notebooks.html">MATE Python Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-rest-api.html">Using the REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">MATE API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference external" href="api.html#http://">MATE REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hacking.html">Hacking on MATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Writing and running MATE’s tests</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MATE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Architecture</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/architecture.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="architecture">
<h1>Architecture<a class="headerlink" href="#architecture" title="Permalink to this headline">¶</a></h1>
<p>This page provides an index of tools and components within MATE. For a
higher-level overview of MATE, see <a class="reference internal" href="overview.html"><span class="doc">Overview</span></a>.</p>
<div class="section" id="analysis-workflow">
<span id="id1"></span><h2>Analysis Workflow<a class="headerlink" href="#analysis-workflow" title="Permalink to this headline">¶</a></h2>
<p>The MATE workflow can be visualized as a transition from some source-code
representation of a program, to a compilation that can produce one or more
executables, to one <a class="reference internal" href="cpg.html"><span class="doc">CPG</span></a> build per executable, and finally to
individual analyses run on each CPG:</p>
<img alt="_images/mate-workflow.png" src="_images/mate-workflow.png" />
</div>
<div class="section" id="system-architecture">
<h2>System architecture<a class="headerlink" href="#system-architecture" title="Permalink to this headline">¶</a></h2>
<p>The MATE system is decomposed into eight services:</p>
<dl class="simple">
<dt>server</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">server</span></code> component presents <a class="reference internal" href="using-rest-api.html"><span class="doc">a REST API</span></a> that can
be used to initiate individual steps of the analysis workflow depicted above.
This API allows users to manually run analysis steps with custom options or
changes in response to errors. The server API also implements backend queries
for MATE UI components including Flowfinder.</p>
</dd>
<dt>executor</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">executor</span></code> component asynchronously processes long-running
requests initiated by the <code class="docutils literal notranslate"><span class="pre">server</span></code> component, such as program
compilation, CPG generation, and <a class="reference internal" href="pois.html"><span class="doc">POI analyses</span></a>.</p>
</dd>
<dt>db</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">db</span></code> component runs a standard PostgreSQL installation and
stores all generated Code Property Graphs. Other components
(including other components of MATE) can access CPGs via the MATE
domain-specific query language connected to the database. In addition
to storing CPGs, the <code class="docutils literal notranslate"><span class="pre">db</span></code> component stores all persistent MATE
system state.</p>
</dd>
<dt>storage</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">storage</span></code> component supplements the <code class="docutils literal notranslate"><span class="pre">db</span></code> component with a
MinIO object store and is used to store large analysis artifacts
such as program source code, compiled binaries, and logs.</p>
</dd>
<dt>broker</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">broker</span></code> component is a MATE-internal message bus used to
coordinate MATE components.</p>
</dd>
<dt>mate-ui</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">mate-ui</span></code> component serves a web-based user-interface to the MATE
system. It provides access to <a class="reference internal" href="using-flowfinder.html"><span class="doc">Flowfinder</span></a>,
<a class="reference internal" href="under-constrained-manticore.html"><span class="doc">Under-constrained Manticore</span></a>, and an interface to monitor the
compilation and CPG generation processes.</p>
</dd>
<dt>notebook</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">notebook</span></code> component provides a <a class="reference internal" href="using-notebooks.html"><span class="doc">Jupyter notebook environment</span></a> for interacting with the MATE system via <a class="reference internal" href="overview.html#overview-query"><span class="std std-ref">the Python
domain-specific query language</span></a>.</p>
</dd>
<dt>mantiserve</dt><dd><p>The <code class="docutils literal notranslate"><span class="pre">mantiserve</span></code> component exposes <a class="reference internal" href="mantiserve.html"><span class="doc">a REST API</span></a> for
running symbolic execution queries against programs. The API allows symbolic
execution tasks to be parameterized by specific detector plugins that monitor
for potential vulnerabilities.</p>
</dd>
</dl>
</div>
<div class="section" id="docker-images-and-compositions">
<span id="docker"></span><h2>Docker Images and Compositions<a class="headerlink" href="#docker-images-and-compositions" title="Permalink to this headline">¶</a></h2>
<p>The above services are deployed in Docker containers using <code class="docutils literal notranslate"><span class="pre">docker-compose</span></code>.</p>
<div class="section" id="docker-images">
<h3>Docker Images<a class="headerlink" href="#docker-images" title="Permalink to this headline">¶</a></h3>
<div class="section" id="first-party">
<h4>First-Party<a class="headerlink" href="#first-party" title="Permalink to this headline">¶</a></h4>
<p>The following images are built from the top-level <code class="docutils literal notranslate"><span class="pre">Dockerfile</span></code> in CI, and can
be built manually by supplying the <code class="docutils literal notranslate"><span class="pre">--target</span></code> flag to <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">build</span></code>. The
default target is <code class="docutils literal notranslate"><span class="pre">dev</span></code>. By convention, the images are usually tagged with the
target names prefixed by <code class="docutils literal notranslate"><span class="pre">mate-</span></code>, e.g., <code class="docutils literal notranslate"><span class="pre">mate-dist</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">dev</span></code>: An image with all of the tools necessary to develop MATE, including
build systems, complilers, linters, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dist</span></code>: An image with MATE installed</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">notebook</span></code>: Jupyter Notebook server</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ui</span></code>: Web UI components (Flowfinder, builds page, etc.)</p></li>
</ul>
</div>
<div class="section" id="third-party">
<h4>Third-Party<a class="headerlink" href="#third-party" title="Permalink to this headline">¶</a></h4>
<p>These images are used in MATE compositions, but contain third-party software.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">postgres</span></code>: Used for the <code class="docutils literal notranslate"><span class="pre">db</span></code> component (described above)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">rabbitmq</span></code>: : Used for the <code class="docutils literal notranslate"><span class="pre">broker</span></code> component (described above)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">minio</span></code>: Used for the <code class="docutils literal notranslate"><span class="pre">storage</span></code> component (described above)</p></li>
</ul>
</div>
</div>
<div class="section" id="docker-compositions">
<h3>Docker Compositions<a class="headerlink" href="#docker-compositions" title="Permalink to this headline">¶</a></h3>
<p>MATE has several <code class="docutils literal notranslate"><span class="pre">docker-compose.*.yml</span></code> files. These are generally run in
conjunction with <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code>, e.g.:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">yml</span> <span class="o">-</span><span class="n">f</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span><span class="o">.</span><span class="n">ui</span><span class="o">.</span><span class="n">yml</span> <span class="n">up</span>
</pre></div>
</div>
<p>On especially powerful hosts, <code class="docutils literal notranslate"><span class="pre">docker-compose.yml</span></code> can be replaced with
<code class="docutils literal notranslate"><span class="pre">docker-compose.large.yml</span></code>. Each of the other compositions runs particular
services:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.clients.yml</span></code>: Run an IPython (Jupyter) shell from the command-line,
without using the MATE Notebooks service.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.notebook.yml</span></code>: Runs the <code class="docutils literal notranslate"><span class="pre">notebook</span></code> service, see <a class="reference internal" href="using-notebooks.html"><span class="doc">MATE Python Notebooks</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.test.yml</span></code>: Used by MATE developers to test MATE, see <a class="reference internal" href="hacking.html"><span class="doc">Hacking on MATE</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.ui.dev.yml</span></code>: Used by MATE developers to develop MATE, see <a class="reference internal" href="hacking.html"><span class="doc">Hacking on MATE</span></a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.ui.yml</span></code>: Runs the <code class="docutils literal notranslate"><span class="pre">mate-ui</span></code> service.</p></li>
</ul>
</div>
</div>
<div class="section" id="component-index">
<h2>Component index<a class="headerlink" href="#component-index" title="Permalink to this headline">¶</a></h2>
<div class="section" id="compilation-components">
<h3>Compilation components<a class="headerlink" href="#compilation-components" title="Permalink to this headline">¶</a></h3>
<p>The following tools and components are responsible for compiling a program into an
LLVM bitcode module that is suitable for CPG generation.</p>
<div class="section" id="blight">
<span id="blight-desc"></span><h4>blight<a class="headerlink" href="#blight" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Trail of Bits (<a class="reference external" href="https://github.com/trailofbits/blight">GitHub</a>)</p>
<p><code class="docutils literal notranslate"><span class="pre">blight</span></code> is a build tool wrapper for C/C++ compilers (<code class="docutils literal notranslate"><span class="pre">cc</span></code> and <code class="docutils literal notranslate"><span class="pre">c++</span></code>) as well as the
standalone preprocessor (<code class="docutils literal notranslate"><span class="pre">cpp</span></code>), assembler (<code class="docutils literal notranslate"><span class="pre">as</span></code>), linker (<code class="docutils literal notranslate"><span class="pre">ld</span></code>), and other standard
build tools.</p>
<p>MATE uses <code class="docutils literal notranslate"><span class="pre">blight</span></code> for instrumenting arbitrary program build systems, ensuring that
they can be eventually ingested as CPGs. <code class="docutils literal notranslate"><span class="pre">blight</span></code>’s responsibilities include:</p>
<ol class="arabic simple">
<li><p>Ensuring that MATE’s required compilation flags are <em>always</em> passed to individual compiler
invocations.</p></li>
<li><p>Saving an accurate record of each step in a build process, to improve recompilation fidelity.</p></li>
<li><p>Saving an accurate record of each output of each build step, so that multiple independent
CPGs can be produced from a build system that produces more than one executable.</p></li>
<li><p>Dispatching to <a class="reference internal" href="#gllvm-desc"><span class="std std-ref">GLLVM</span></a> for bitcode generation.</p></li>
</ol>
</div>
<div class="section" id="gllvm">
<span id="gllvm-desc"></span><h4>GLLVM<a class="headerlink" href="#gllvm" title="Permalink to this headline">¶</a></h4>
<p>Provenance: SRI-CSL (3rd-party, <a class="reference external" href="https://github.com/SRI-CSL/gllvm">GitHub</a>)</p>
<p>GLLVM is a suite of tools for wrapping <code class="docutils literal notranslate"><span class="pre">clang</span></code> and <code class="docutils literal notranslate"><span class="pre">clang++</span></code> to emit bitcode for every
intermediate output, as well combining those intermediate bitcode outputs into a unified
LLVM IR module.</p>
</div>
<div class="section" id="compilation-tasks">
<span id="compile-desc"></span><h4>Compilation tasks<a class="headerlink" href="#compilation-tasks" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Trail of Bits</p>
<p>The <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/build/compile.py</span></code> module manages the process of
compiling programs submitted to MATE while monitoring and controlling the build
process to create artifacts that can be analyzed by other MATE components. This
module is responsible for creating Docker environments in which to compile
programs on demand, inferring build system configurations and necessary
options, and creating and storing artifacts for further analysis.</p>
</div>
</div>
<div class="section" id="cpg-generation-components">
<h3>CPG generation components<a class="headerlink" href="#cpg-generation-components" title="Permalink to this headline">¶</a></h3>
<p>The following tools and components are responsible for generating various components of the CPG.</p>
<div class="section" id="llvm-middle-end-passes">
<span id="llvm-passes-desc"></span><h4>LLVM middle-end passes<a class="headerlink" href="#llvm-middle-end-passes" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>There are three middle-end passes which read in LLVM bitcode and spew out analysis results. They are loaded dynamically using <code class="docutils literal notranslate"><span class="pre">opt</span></code>. Consult the LLVM documentation to learn about loading passes into <code class="docutils literal notranslate"><span class="pre">opt</span></code>.</p>
<ul class="simple">
<li><p>The <a class="reference internal" href="#points-to-desc"><span class="std std-ref">pointer analysis</span></a> lives in <code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis/</span></code>.</p></li>
<li><p>Many nodes and edges of the CPG are created in
<code class="docutils literal notranslate"><span class="pre">llvm/MATE/ASTGraphWriter.cpp</span></code>, <a class="reference internal" href="cpg.html#cpg-provenance"><span class="std std-ref">including</span></a>: the LLVM
AST, intra-procedural CFGs, intra-procedural (non-memory) DFGs, and the CDG.
<code class="docutils literal notranslate"><span class="pre">ASTGraphWriter</span></code> also formats the output of the pointer analysis for
inclusion in the CPG.</p></li>
<li><p>Basic blocks are instrumented to generate <a class="reference internal" href="trace.html"><span class="doc">traces</span></a> for dynamic
analysis in <code class="docutils literal notranslate"><span class="pre">llvm/MATE/TraceLogger.cpp</span></code>.</p></li>
</ul>
<p>Known Problems: ASTGraphWriter does not properly handle exceptional control
flow; such exceptional flows will not be reflected in higher-level tools like
Flowfinder or notebook queries.</p>
<p>Expected Problems: ASTGraphWriter may be unaware of the semantics of more
obscure LLVM instructions and intrinsics.</p>
</div>
<div class="section" id="points-to-analysis">
<span id="points-to-desc"></span><h4>Points-to analysis<a class="headerlink" href="#points-to-analysis" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>MATE’s code property graph representation is built on top of the results of a
precise, context-sensitive, whole-program points-to analysis that allows for
accurate, narrow tracking of data- and control-flow through the program under
analysis.</p>
<p>The points-to analysis implementation is located in the <code class="docutils literal notranslate"><span class="pre">llvm/PointerAnalysis</span></code>
directory.</p>
<p>See <a class="reference external" href="https://galoisinc.github.io/cclyzerpp/">the upstream documentation</a> for
more information.</p>
<p>Known problems: Refer to the upstream documentation.</p>
</div>
<div class="section" id="machine-code-mapping-tools">
<span id="machine-desc"></span><h4>Machine-code mapping tools<a class="headerlink" href="#machine-code-mapping-tools" title="Permalink to this headline">¶</a></h4>
<p>These tools are responsible for incorporating binary-level information into the CPG and linking
binary-level information against the core LLVM CPG elements.</p>
<div class="section" id="nomina">
<span id="nomina-desc"></span><h5>Nomina<a class="headerlink" href="#nomina" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>Nomina is an LLVM pass responsible for canonicalizing the names
of basic blocks in LLVM bitcode. Nomina’s canonicalization enables
different versions of LLVM running on potentially separate machines
to consistently identify the same basic blocks and associate them
with other program features.</p>
<p>Known problems: None</p>
<p>Expected problems: None</p>
</div>
<div class="section" id="headache">
<span id="headache-desc"></span><h5>Headache<a class="headerlink" href="#headache" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>Headache is an LLVM pass with a collection of responsibilities:</p>
<ul class="simple">
<li><p>Extracting information about each compilation (i.e., translation) unit in the bitcode module</p></li>
<li><p>Extracting variable information (VI) about each global, local, and argument in the bitcode module</p></li>
<li><p>Extracting deduplicated DWARF type information (TI), for later pairing with the VI</p></li>
</ul>
<p>Headache’s compilation unit information extraction is used to inform <a class="reference internal" href="#quotidian-desc"><span class="std std-ref">quotidian</span></a>’s
recompilation.</p>
<p>Known problems: Headache’s type extraction for template parameters is incomplete.</p>
<p>Expected problems: Headache performs scope unrolling to present a full picture of the lexical
scope in which a variable appears. The complexities of DWARF mean that there are probably
unhandled edge cases in Headache’s scope handling.</p>
</div>
<div class="section" id="wedlock">
<span id="wedlock-desc"></span><h5>Wedlock<a class="headerlink" href="#wedlock" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>Wedlock is a <em>backend</em> LLVM pass responsible for pairing the IR representation of a bitcode
module with LLVM’s “middle-end” representation.</p>
<p>Known problems: Pretty-printing LLVM’s MIR is slow, so Wedlock doesn’t do it by default.</p>
<p>Expected problems: Wedlock observes program features that are only produced during LLVM’s code
generation phrase, such as <code class="docutils literal notranslate"><span class="pre">%unwind_resume</span></code> blocks for DWARF-style exception handling.
These can’t be easily paired with the IR blocks seen during processing in LLVM frontend passes
(i.e. <a class="reference internal" href="#nomina-desc"><span class="std std-ref">Nomina</span></a> and ASTGraphWriter) because they don’t exist in the IR
until lowering begins.</p>
</div>
<div class="section" id="migraine">
<span id="migrane-desc"></span><h5>migraine<a class="headerlink" href="#migraine" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>migraine is a Python module and utility responsible for emitting a patch of assembler directives
based on <a class="reference internal" href="#wedlock-desc"><span class="std std-ref">Wedlock</span></a>’s output. migraine’s assembler directive patch is later used during
recompilation to generate a special <code class="docutils literal notranslate"><span class="pre">.migraine_addrs</span></code> section that <a class="reference internal" href="#aspirin-desc"><span class="std std-ref">aspirin</span></a> uses for
basic block pairing.</p>
<p>Known problems: None.</p>
<p>Expected problems: None.</p>
</div>
<div class="section" id="aspirin">
<span id="aspirin-desc"></span><h5>aspirin<a class="headerlink" href="#aspirin" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>aspirin is a Python module and utility with a collection of responsibilities:</p>
<ul class="simple">
<li><p>Pairing each IR-level function and basic block with layout information
(i.e. virtual address, offset, and size) in the “canonical” compiled binary</p></li>
<li><p>Pairing <a class="reference internal" href="#headache-desc"><span class="std std-ref">Headache</span></a>’s variable information with each parameter and local variable in the
compiled binary, including scoping information</p></li>
</ul>
<p>Known problems: aspirin’s handling of inlined functions, scopes, and variables is probably
deficient due to DWARF’s complexity.</p>
<p>Expected problems: None.</p>
</div>
<div class="section" id="margin-walker">
<span id="margin-walker-desc"></span><h5>margin-walker<a class="headerlink" href="#margin-walker" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>margin-walker is a Python module and utility responsible for emitting MATE-compatible CPG records
based on the combined input of <a class="reference internal" href="#wedlock-desc"><span class="std std-ref">Wedlock</span></a> and <a class="reference internal" href="#aspirin-desc"><span class="std std-ref">aspirin</span></a>, as well as
<a class="reference internal" href="#headache-desc"><span class="std std-ref">Headache</span></a>’s type information.</p>
<p>Known problems: None.</p>
<p>Expected problems: margin-walker’s runtime and memory usage will probably grow (roughly)
quadratically with program size.</p>
</div>
<div class="section" id="quotidian">
<span id="quotidian-desc"></span><h5>quotidian<a class="headerlink" href="#quotidian" title="Permalink to this headline">¶</a></h5>
<p>Provenance: Trail of Bits</p>
<p>quotidian is a Python module and utility that represents the primary ingress and egress for all Trail of Bits
provided instrumentation. It takes <em>either</em> a bitcode input <em>or</em> a G/WLLVM-compiled binary input.</p>
<p>quotidian does not require <a class="reference internal" href="#nomina-desc"><span class="std std-ref">Nomina</span></a> to be run in the input bitcode beforehand. However,
failing to do so and using quotidian’s bitcode elsewhere <em>will</em> cause canonicalization issues.</p>
<p>Known problems: None.</p>
<p>Expected problems: None.</p>
</div>
<div class="section" id="machine-code-mapping-dependencies">
<h5>Machine code mapping dependencies<a class="headerlink" href="#machine-code-mapping-dependencies" title="Permalink to this headline">¶</a></h5>
<p>The following depicts the dependency relations between various Trail of Bits tools and the JSONL ultimately
generated for insertion into the CPG.</p>
<img alt="Dependency relations between Trail of Bits tools and the CPG" src="_images/tob-tool-graph.png" />
<p>The above image should be kept up-to-date with the following
MermaidJS specification:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">graph</span> <span class="n">TD</span>
<span class="n">A</span><span class="p">[</span><span class="n">CPG</span> <span class="n">JSONL</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">margin</span><span class="o">-</span><span class="n">walker</span><span class="o">|</span><span class="n">E</span><span class="p">[</span><span class="n">Wedlock</span> <span class="n">JSONL</span><span class="p">]</span>
<span class="n">A</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">margin</span><span class="o">-</span><span class="n">walker</span><span class="o">|</span><span class="n">L</span>
<span class="n">F</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">migraine</span><span class="o">|</span><span class="n">E</span>
<span class="n">F</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">migraine</span><span class="o">|</span><span class="n">G</span><span class="p">[</span><span class="n">Migraine</span> <span class="n">patch</span><span class="p">]</span>
<span class="n">G</span> <span class="o">--&gt;</span> <span class="n">E</span>
<span class="n">F</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">migraine</span><span class="o">|</span><span class="n">H</span><span class="p">[</span><span class="n">Unpatched</span> <span class="n">ASM</span><span class="p">]</span>
<span class="n">E</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">wedlock</span><span class="o">|</span><span class="n">I</span><span class="p">[</span><span class="n">Headache</span> <span class="n">IR</span><span class="p">]</span>
<span class="n">H</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">wedlock</span><span class="o">|</span><span class="n">I</span>
<span class="n">I</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">headache</span><span class="o">|</span><span class="n">J</span><span class="p">[</span><span class="n">Canonicalized</span> <span class="n">IR</span><span class="p">]</span>
<span class="n">J</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">nomina</span><span class="o">|</span><span class="n">K</span><span class="p">[</span><span class="n">Uncanonicalized</span> <span class="n">IR</span><span class="p">]</span>
<span class="n">K</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">clang</span><span class="o">|</span><span class="n">N</span><span class="p">[</span><span class="n">Source</span><span class="p">]</span>
<span class="n">M</span><span class="p">[</span><span class="n">Compiled</span> <span class="n">binary</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">llc</span><span class="o">|</span><span class="n">F</span><span class="p">[</span><span class="n">Migraine</span> <span class="n">ASM</span><span class="p">]</span>
<span class="n">L</span><span class="p">[</span><span class="n">Aspirin</span> <span class="n">JSONL</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">aspirin</span><span class="o">|</span><span class="n">M</span>
<span class="n">L</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">aspirin</span><span class="o">|</span><span class="n">Q</span><span class="p">[</span><span class="n">headache</span> <span class="n">VI</span> <span class="n">JSONL</span><span class="p">]</span>
<span class="n">Q</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">headache</span><span class="o">|</span><span class="n">J</span>
<span class="n">P</span><span class="p">[</span><span class="n">headache</span> <span class="n">TI</span> <span class="n">JSONL</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">headache</span><span class="o">|</span><span class="n">J</span>
<span class="n">O</span><span class="p">[</span><span class="n">CU</span> <span class="n">JSONL</span><span class="p">]</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">headache</span><span class="o">|</span><span class="n">J</span>
<span class="n">A</span> <span class="o">--&gt;</span> <span class="o">|</span><span class="n">margin</span><span class="o">-</span><span class="n">walker</span><span class="o">|</span><span class="n">P</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-tasks">
<h4>Build tasks<a class="headerlink" href="#build-tasks" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Trail of Bits</p>
<p>The <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/build/build.py</span></code> module manages the process of creating
CPGs for programs submitted to MATE. This module is responsible for creating
Docker environments in which to recompile programs and perform machine code
mapping, along with managing the overall CPG generation process. This module
also manages incorporating source code information in the CPG and applying
analysis signatures.</p>
</div>
</div>
<div class="section" id="analysis-components">
<h3>Analysis components<a class="headerlink" href="#analysis-components" title="Permalink to this headline">¶</a></h3>
<div class="section" id="cpg-query-api">
<span id="query-desc"></span><h4>CPG Query API<a class="headerlink" href="#cpg-query-api" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>MATE provides a <a class="reference external" href="https://docs.sqlalchemy.org/en/13/">SQLAlchemy</a>-based Domain
Specific Language (DSL) for querying the CPG, embedded in Python. It has
abstractions relevant to program analysis, for example, control- and data-flow
path queries. This interface abstracts the core property-graph representation
stored in the PostgreSQL database and provides a programmatic, object-based
interface. This query API is used to implement MATE’s automated analyses and
user interface, and is also available to users via the Jupyter Notebook service.</p>
<p>The query API is implemented in the <code class="docutils literal notranslate"><span class="pre">frontend/mate-query/mate_query/cpg</span></code>
directory.</p>
<p>See the <a class="reference internal" href="api/MATE/modules.html"><span class="doc">API documentation</span></a> for the API reference. This
documentation can also be accessed from Python code with the <code class="docutils literal notranslate"><span class="pre">help</span></code> function.
It may also be helpful to look at <a class="reference internal" href="cpg.html"><span class="doc">The Code Property Graph</span></a>, <a class="reference internal" href="schemata/cpg.html"><span class="doc">CPG Schema</span></a>, and <a class="reference external" href="https://llvm.org/docs/LangRef.html#llvm-ptrmask-intrinsic">the LLVM
Language Reference</a>
to better understand the content of the CPG.</p>
</div>
<div class="section" id="context-free-language-reachability-queries">
<h4>Context-free language reachability queries<a class="headerlink" href="#context-free-language-reachability-queries" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>In addition to the core query language, MATE provides specialized
queries for answering “context-free language” (CFL) reachability
queries. CFL-reachability queries are reachability queries on the
graph that impose additional constraints about the nodes or edges
visited by paths in the graph—for example, requiring the
control-flow paths along function invocation and return paths
represent matching control transfers that can be realized by concrete
executions. To support CFL-reachability queries, MATE implements a
general-purpose API for implementing graph traversals guided by a
specified push-down automata that tracks required conditions. MATE
includes built-in CFL-reachability analyses for precise control-flow,
dataflow, and call-graph queries. The CFL-reachability framework is
implemented in the modules <code class="docutils literal notranslate"><span class="pre">frontend/mate-query/mate_query/db.py</span></code> and
<code class="docutils literal notranslate"><span class="pre">frontend/mate-query/mate_query/cfl.py</span></code>. The module
<code class="docutils literal notranslate"><span class="pre">frontend/mate-query/mate_query/cpg/query/cfg_avoiding.py</span></code> implements a wrapper
around the functionality for common vulnerability discovery queries
that require identifying control-flow paths within the program that do
not visit specific nodes.</p>
</div>
<div class="section" id="poi-framework">
<h4>POI framework<a class="headerlink" href="#poi-framework" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>The “Points of Interest” (POI) framework provides facilities to register,
run, and store results from automated analyses of the code property
graph. POI analyses are managed via a REST API implemented in
<code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/server/api/analyses.py</span></code> and are executed by the
<code class="docutils literal notranslate"><span class="pre">executor</span></code> component.</p>
</div>
<div class="section" id="poi-analyses">
<h4>POI analyses<a class="headerlink" href="#poi-analyses" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois/Trail of Bits</p>
<p>MATE ships with a number of automated analyses that detect potential
vulnerabilities, called Points of Interest (POIs). These analyses are
implemented as Python modules in the <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/poi/analysis</span></code>
directory.</p>
<p>See <a class="reference internal" href="pois.html"><span class="doc">Points of Interest</span></a> for more information.</p>
</div>
</div>
<div class="section" id="user-interface-components">
<h3>User interface components<a class="headerlink" href="#user-interface-components" title="Permalink to this headline">¶</a></h3>
<div class="section" id="ui-client-and-flowfinder">
<h4>ui-client and Flowfinder<a class="headerlink" href="#ui-client-and-flowfinder" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Galois</p>
<p>The <code class="docutils literal notranslate"><span class="pre">ui-client</span></code> directory includes the browser-based frontend
interface to the MATE system, implemented in Typescript using the
React framework. It provides a user-facing interfacing for monitoring
MATE system status and viewing analysis results. Backend queries
supporting the interface are executed by the <code class="docutils literal notranslate"><span class="pre">server</span></code> component and
implemented by modules in the <code class="docutils literal notranslate"><span class="pre">frontend/mate/mate/server/api</span></code> directory.</p>
<p>Flowfinder is a browser-based graphical user interface for accessing
the MATE CPG and exploring MATE analysis results. It is implemented
in Typescript using React and the cytoscape.js graph visualization
framework.</p>
</div>
<div class="section" id="mantiserve">
<h4>Mantiserve<a class="headerlink" href="#mantiserve" title="Permalink to this headline">¶</a></h4>
<p>Provenance: Trail of Bits</p>
<p>MATE’s symbolic execution capabilities are exposed via the Mantiserve component,
located in the <code class="docutils literal notranslate"><span class="pre">mantiserve</span></code> directory. Mantiserve provides a REST API for
configuring symbolic execution tasks, enabling detectors for a variety of bug
classes, and managing the lifecycle of individual runs of the underlying
Manticore symbolic execution platform. Mantiserve additionally adapts
Manticore’s runtime environment, allowing Manticore runs to be isolated within
containers that are identical to the “normal” execution environment for a
target.</p>
<p>Mantiserve tasks are configured to run one or more <a class="reference internal" href="dwarfcore.html"><span class="doc">“detectors,”</span></a> representing the dynamic counterpart to MATE’s static “POI”
analyses. Each detector has access to the MATE CPG for the targeted program,
including a queryable graph representation of the program’s binary layout and
debug information (via DWARF). These detectors are written using Manticore’s
public plugin API, and are located in the <code class="docutils literal notranslate"><span class="pre">dwarfcore</span></code> directory.</p>
</div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="cli.html" class="btn btn-neutral float-right" title="Command-Line Tools Reference" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="tutorial-notebooks.html" class="btn btn-neutral float-left" title="Notebook Tutorial" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2022, The MATE Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>