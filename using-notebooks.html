

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>MATE Python Notebooks &mdash; MATE 0.1.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/sphinx_paramlinks.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using the REST API" href="using-rest-api.html" />
    <link rel="prev" title="Using Flowfinder" href="using-flowfinder.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> MATE
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Start Here</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quick Start</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="architecture.html">Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command-Line Tools Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli-overview.html">CLI Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="cpg.html">The Code Property Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging-builds.html">Debugging Program Build Failures</a></li>
<li class="toctree-l1"><a class="reference internal" href="dwarfcore.html">Dwarfcore</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment variables in the MATE container</a></li>
<li class="toctree-l1"><a class="reference internal" href="mantiserve.html">Mantiserve</a></li>
<li class="toctree-l1"><a class="reference internal" href="pois.html">Points of Interest</a></li>
<li class="toctree-l1"><a class="reference internal" href="schemata/cpg.html">CPG Schema</a></li>
<li class="toctree-l1"><a class="reference internal" href="signatures.html">MATE Signatures</a></li>
<li class="toctree-l1"><a class="reference internal" href="trace.html">Traces</a></li>
<li class="toctree-l1"><a class="reference internal" href="under-constrained-manticore.html">Under-constrained Manticore</a></li>
<li class="toctree-l1"><a class="reference internal" href="usagefinder.html">UsageFinder</a></li>
<li class="toctree-l1"><a class="reference internal" href="using-flowfinder.html">Using Flowfinder</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">MATE Python Notebooks</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-a-notebook">Create a notebook</a></li>
<li class="toctree-l2"><a class="reference internal" href="#load-the-desired-code-property-graph">Load the desired code property graph</a></li>
<li class="toctree-l2"><a class="reference internal" href="#query-the-code-property-graph">Query the code property graph</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="using-rest-api.html">Using the REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">MATE API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html#indices-and-tables">Indices and tables</a></li>
<li class="toctree-l1"><a class="reference external" href="api.html#http://">MATE REST API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hacking.html">Hacking on MATE</a></li>
<li class="toctree-l1"><a class="reference internal" href="legal.html">Legal</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Writing and running MATE’s tests</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">MATE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>MATE Python Notebooks</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/using-notebooks.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="mate-python-notebooks">
<h1>MATE Python Notebooks<a class="headerlink" href="#mate-python-notebooks" title="Permalink to this headline">¶</a></h1>
<p>MATE has <a href="#id1"><span class="problematic" id="id2">:ref:`a Python API &lt;query_desc&gt;`_</span></a> for querying <a class="reference internal" href="cpg.html"><span class="doc">the CPG</span></a> and
exposes browser-based, interactive Jupyter notebooks with this query interface
pre-loaded. These notebooks can be used to write complex, recursive,
whole-program queries that answer detailed questions like “What sequences of
function calls can lead from point A to point B in this program?” or “Can user
input flow into a memory location with a specific struct type, and from there to
some particular function without passing through one of these three sanitization
routines?” These notebooks can be used for one-off explorations, or as a
platform for users to build reusable apps on the MATE platform (such as
<a class="reference internal" href="usagefinder.html"><span class="doc">UsageFinder</span></a>).</p>
<p>The MATE notebook server is exposed via web interface at <a class="reference external" href="http://localhost:8889/">http://localhost:8889/</a>.</p>
<div class="section" id="create-a-notebook">
<h2>Create a notebook<a class="headerlink" href="#create-a-notebook" title="Permalink to this headline">¶</a></h2>
<p>Navigate to the MATE notebook server at <a class="reference external" href="http://localhost:8889/">http://localhost:8889/</a> and use the “New” dropdown to create a new Python3 notebook.</p>
<div class="figure align-default" id="id4">
<a class="reference internal image-reference" href="_images/create-notebook.png"><img alt="_images/create-notebook.png" src="_images/create-notebook.png" style="width: 604.0999999999999px; height: 216.29999999999998px;" /></a>
<p class="caption"><span class="caption-text">Create a new Python3 notebook</span><a class="headerlink" href="#id4" title="Permalink to this image">¶</a></p>
</div>
<p>Optional: click the notebook name (initially “Untitled”) to give it a more descriptive name.</p>
<div class="figure align-default" id="id5">
<img alt="_images/rename-notebook.jpg" src="_images/rename-notebook.jpg" />
<p class="caption"><span class="caption-text">Rename the notebook</span><a class="headerlink" href="#id5" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="load-the-desired-code-property-graph">
<h2>Load the desired code property graph<a class="headerlink" href="#load-the-desired-code-property-graph" title="Permalink to this headline">¶</a></h2>
<p>Within a Python notebook, you need to identify the Code Property Graph you wish to query.
You’ll need the Build Id for the target you’re interested in.
You can copy it from the MATE dashboard: <a class="reference external" href="http://localhost:8050/">http://localhost:8050/</a></p>
<div class="figure align-default" id="id6">
<a class="reference internal image-reference" href="_images/get-build-id.png"><img alt="_images/get-build-id.png" src="_images/get-build-id.png" style="width: 744.0999999999999px; height: 120.39999999999999px;" /></a>
<p class="caption"><span class="caption-text">The BuildID for a target</span><a class="headerlink" href="#id6" title="Permalink to this image">¶</a></p>
</div>
<p>Now, in your MATE notebook enter the following into the first cell, replacing the placeholder Build Id with the one copied from the MATE dashboard:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">session</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">new_session</span><span class="p">()</span>

<span class="c1">## TODO: replace the build ID in the next line with the ID from the dashboard</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Build</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;fd60a24c857647a4b6707fea56a69db8&quot;</span><span class="p">)</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">graph_from_build</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Graph loaded with </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> Nodes and </span><span class="si">{</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">Edge</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="si">}</span><span class="s2"> Edges&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>You’ll know it’s working if you get nonzero number of nodes and edges as output.</p>
<div class="figure align-default" id="id7">
<img alt="_images/notebook-load-graph.jpg" src="_images/notebook-load-graph.jpg" />
<p class="caption"><span class="caption-text">Loading a CPG in a notebook</span><a class="headerlink" href="#id7" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="query-the-code-property-graph">
<h2>Query the code property graph<a class="headerlink" href="#query-the-code-property-graph" title="Permalink to this headline">¶</a></h2>
<p>The MATE notebook uses
<a class="reference external" href="https://www.sqlalchemy.org/">SQLAlchemy</a> to expose the CPG as Python objects.
See <a class="reference internal" href="architecture.html#query-desc"><span class="std std-ref">CPG Query API</span></a> for more information and <a class="reference internal" href="api/MATE/modules.html"><span class="doc">API documentation</span></a> for a complete reference. The reference documentation is
also available inside Python via the <code class="docutils literal notranslate"><span class="pre">help</span></code> function.</p>
<p>Below are some examples queries.
Each assume <code class="docutils literal notranslate"><span class="pre">session</span></code>, <code class="docutils literal notranslate"><span class="pre">b</span></code>, and <code class="docutils literal notranslate"><span class="pre">g</span></code> have been initialized as described above.</p>
<p>Print every external (e.g. located in <code class="docutils literal notranslate"><span class="pre">libc</span></code> ) function, each followed by a list of all the application functions that invoke it:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">Function</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">is_declaration</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
   <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;### &#39;&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s2">&quot;&#39; is invoked by:&quot;</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">callers</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="n">c</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</pre></div>
</div>
<p>CPGs are made of nodes and edges.
Some useful utility functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># print node IDs &lt;-&gt; llvm for a Function object</span>
<span class="k">def</span> <span class="nf">show_llvm</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
   <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;### </span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s2"> ###&quot;</span><span class="p">)</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">b</span><span class="o">.</span><span class="n">instructions</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">attributes</span><span class="p">[</span><span class="s1">&#39;pretty_string&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># print node IDs &lt;-&gt; llvm for a Function given a function name</span>
<span class="k">def</span> <span class="nf">show_llvm_fname</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
   <span class="n">show_llvm</span><span class="p">(</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">Function</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">demangled_name</span><span class="o">=</span><span class="n">fname</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">())</span>

<span class="c1"># helper: turn a node UUID into the corresponding Node object</span>
<span class="k">def</span> <span class="nf">nid</span><span class="p">(</span><span class="n">uuid</span><span class="p">):</span>
   <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">Node</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">uuid</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="p">))</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
</pre></div>
</div>
<div class="figure align-default" id="id8">
<a class="reference internal image-reference" href="_images/notebook-node-example.png"><img alt="_images/notebook-node-example.png" src="_images/notebook-node-example.png" style="width: 642.5999999999999px; height: 438.9px;" /></a>
<p class="caption"><span class="caption-text">Example: Using the functions above to print LLVM for a function, and using this to access a Node (corresponding to a call to <code class="docutils literal notranslate"><span class="pre">fprintf</span></code>)</span><a class="headerlink" href="#id8" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="using-rest-api.html" class="btn btn-neutral float-right" title="Using the REST API" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="using-flowfinder.html" class="btn btn-neutral float-left" title="Using Flowfinder" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2019-2022, The MATE Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>